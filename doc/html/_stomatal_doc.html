<!-- HTML header for doxygen 1.12.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Helios: Stomatal Conductance Model Plugin Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph_link.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript">
  DoxygenAwesomeDarkModeToggle.init()
  DoxygenAwesomeParagraphLink.init()
  DoxygenAwesomeTabs.init()
  DoxygenAwesomeInteractiveToc.init()
</script>
<script>
    try {
        // Remove the stored “last visited page” so the tree always starts fresh
        Cookie.eraseSetting('navpath');
        localStorage.removeItem('navpath');
        // Older Doxygen versions might use this key:
        localStorage.removeItem('nav-sync-path');
        // Force panel synchronization on by default
        localStorage.setItem('navsync', 'true');
        // (fallback for some older builds)
        localStorage.setItem('nav-sync', 'true');
    } catch(e) {
        /* storage unavailable? ignore */
    }
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-93BB4673PE"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-93BB4673PE');
</script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3F0Y5Z6543"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-3F0Y5Z6543');
</script>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="5">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="Helios_logo_small.png"></td>
  <td id="projectalign">
   <div id="projectname">
       <span id="projectnumber">&#160;v1.3.37</span>
   </div>
  </td>
     <td id="searchbox-container">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('_stomatal_doc.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Stomatal Conductance Model Plugin Documentation</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul>
  <li class="level1">
    <a href="#StomataConstructor">Class Constructor</a>
  </li>
  <li class="level1">
    <a href="#VarsAndProps">Primitive Data</a>
    <ul>
      <li class="level2">
        <a href="#StomatalInputData">Input Primitive Data</a>
      </li>
      <li class="level2">
        <a href="#StomatalOutputData">Output Primitive Data</a>
      </li>
    </ul>
  </li>
  <li class="level1">
    <a href="#StomatalIntro">Introduction</a>
  </li>
  <li class="level1">
    <a href="#BWBTheory">Ball, Woodrow, Berry (1987) Model Theory</a>
  </li>
  <li class="level1">
    <a href="#BBLTheory">Ball-Berry-Leuning Model Theory</a>
  </li>
  <li class="level1">
    <a href="#MoptTheory">Medlyn et al. (2011) Optimality-Based Model</a>
  </li>
  <li class="level1">
    <a href="#BMFTheory">Buckley, Mott, Farquhar (2003) Model (simplified version given in Buckley, Turnbull, and Adams 2012)</a>
  </li>
  <li class="level1">
    <a href="#StomatalUse">Using the Stomatal Conductance Model</a>
    <ul>
      <li class="level2">
        <a href="#StomatalCoeffs">Setting the Model Coefficients</a>
      </li>
      <li class="level2">
        <a href="#StomatalRun">Running the Model (steady-state mode)</a>
      </li>
      <li class="level2">
        <a href="#StomatalRunDyn">Running the Model in Dynamic Mode</a>
      </li>
    </ul>
  </li>
</ul>
</div>
<div class="textblock"><p><br  />
<br  />
 </p>
<table class="doxtable">
<tr>
<th>Dependencies </th><td>None  </td></tr>
<tr>
<th>CMakeLists.txt </th><td>set( PLUGINS "stomatalconductance" )  </td></tr>
<tr>
<th>Header File </th><td>include "StomatalConductanceModel.h"  </td></tr>
<tr>
<th>Class </th><td><a class="el" href="class_stomatal_conductance_model.html">StomatalConductanceModel</a>  </td></tr>
</table>
<h1><a class="anchor" id="StomataConstructor"></a>
Class Constructor</h1>
<table class="doxtable">
<tr>
<th>Constructors  </th></tr>
<tr>
<td><a class="el" href="class_stomatal_conductance_model.html">StomatalConductanceModel( helios::Context* )</a>  </td></tr>
</table>
<h1><a class="anchor" id="VarsAndProps"></a>
Primitive Data</h1>
<h2><a class="anchor" id="StomatalInputData"></a>
Input Primitive Data</h2>
<table class="doxtable">
<tr>
<th>Primitive Data Label </th><th>Symbol </th><th>Units </th><th>Data Type </th><th>Description </th><th>Applicable model(s) </th><th>Available Plug-ins </th><th>Default Value  </th></tr>
<tr>
<td>radiation_flux_PAR </td><td>\(Q\) </td><td>W/m<sup>2</sup> </td><td> <font face="courier" color="green">float</font> </td><td>PAR photon flux density. Note W/m<sup>2</sup> is automatically converted to \(\mu\)mol/m<sup>2</sup>/s using a factor of 4.57. </td><td>BMF </td><td>Can be computed by <a class="el" href="class_radiation_model.html">RadiationModel</a> plug-in. </td><td>0  </td></tr>
<tr>
<td>temperature </td><td>\(T_s\) </td><td>Kelvin </td><td> <font face="courier" color="green">float</font> </td><td>Primitive surface temperature. </td><td>All </td><td>Can be computed by <a class="el" href="class_energy_balance_model.html">EnergyBalanceModel</a> plug-in. </td><td>300 K  </td></tr>
<tr>
<td>air_pressure </td><td>\(p_{atm}\) </td><td>Pascals </td><td> <font face="courier" color="green">float</font> </td><td>Atmospheric pressure. </td><td>All </td><td>N/A </td><td>101,000 Pa  </td></tr>
<tr>
<td>air_temperature </td><td>\(T_a\) </td><td>Kelvin </td><td> <font face="courier" color="green">float</font> </td><td>Temperature of air outside of primitive boundary-layer. </td><td>All </td><td>N/A </td><td>300 K  </td></tr>
<tr>
<td>air_humidity </td><td>\(h\) </td><td>Unitless </td><td> <font face="courier" color="green">float</font> </td><td>Relative humidity of air outside of primitive boundary-layer. </td><td>All </td><td>N/A </td><td>0.5  </td></tr>
<tr>
<td>boundarylayer_conductance** </td><td>\(g_H\) </td><td>mol air/m<sup>2</sup>-s </td><td> <font face="courier" color="green">float</font> </td><td>Boundary-layer conductance to heat. (Assumed that b.l. conductance to moisture is 1.08 that of heat.) </td><td>All </td><td>Can be computed by <a class="el" href="class_b_l_conductance_model.html">BLConductanceModel</a> plug-in, or by <a class="el" href="class_energy_balance_model.html">EnergyBalanceModel</a> plug-in if optional output primitive data "boundarylayer_conductance_out" is enabled. </td><td>0.1 mol/m<sup>2</sup>-s  </td></tr>
<tr>
<td>beta_soil </td><td>\(\beta\) </td><td>unitless </td><td> <font face="courier" color="green">float</font> </td><td>Soil moisture factor, defined as \((\theta-\theta_w)/(\theta_f-\theta_w)\), with \(\theta,\,\theta_f,\,\theta_w\) being the effective soil water content, water content at field capacity, and water content at the wilting point. </td><td>All </td><td>N/A </td><td>1.0  </td></tr>
<tr>
<td>net_photosynthesis </td><td>\(A\) </td><td>\(\mu\)mol/m<sup>2</sup>-s </td><td> <font face="courier" color="green">float</font> </td><td>Net CO<sub>2</sub> (photosynthetic) flux. </td><td>BWB, BBL, Mopt </td><td>Can be computed by <a class="el" href="class_photosynthesis_model.html">PhotosynthesisModel</a> plug-in. </td><td>0  </td></tr>
<tr>
<td>air_CO2 </td><td>\(C_a\) </td><td>\(\mu\)mol/mol </td><td> <font face="courier" color="green">float</font> </td><td>CO<sub>2</sub> concentration of air outside primitive boundary-layer. </td><td>BWB, BBL, Mopt </td><td>N/A </td><td>400 \(\mu\)mol/mol  </td></tr>
<tr>
<td>Gamma_CO2 </td><td>\(\Gamma\) </td><td>\(\mu\)mol/mol </td><td> <font face="courier" color="green">float</font> </td><td>CO<sub>2</sub> compensation point of photosynthesis including dark respiration. (Note: only used for Ball-Berry models.) </td><td>BBL </td><td>Can be computed by <a class="el" href="class_photosynthesis_model.html">PhotosynthesisModel</a> plug-in (need to enable optional primitive data output). </td><td><p class="starttd">100 \(\mu\)mol/mol </p>
<p class="endtd"></p>
</td></tr>
</table>
<p>**The stomatal conductance model will also check for primitive data "boundarylayer_conductance_out" if "boundarylayer_conductance" does not exist. If you are using the energy balance model to calculate the boundary-layer conductance, you should enable optional output primitive data "boundarylayer_conductance_out" so that other plug-ins can use it.</p>
<h2><a class="anchor" id="StomatalOutputData"></a>
Output Primitive Data</h2>
<table class="doxtable">
<tr>
<th>Primitive Data Label </th><th>Symbol </th><th>Units </th><th>Data Type </th><th>Description  </th></tr>
<tr>
<td>moisture_conductance </td><td>\(g_s\) </td><td>mol air/m<sup>2</sup>-sec <br  />
 </td><td> <font face="courier" color="green">float</font> </td><td>Conductance of water vapor through stomata. <br  />
  </td></tr>
</table>
<h1><a class="anchor" id="StomatalIntro"></a>
Introduction</h1>
<p>This plugin implements several different stomatal conductance models. A brief description of the theory behind each model is given below, along with coefficients obtained from several example species.</p>
<p>The default model is the Buckley, Mott, Farquhar model (see <a class="el" href="#BMFTheory">Buckley, Mott, Farquhar (2003) Model (simplified version given in Buckley, Turnbull, and Adams 2012)</a>).</p>
<h1><a class="anchor" id="BWBTheory"></a>
Ball, Woodrow, Berry (1987) Model Theory</h1>
<p>The <a href="https://link.springer.com/chapter/10.1007/978-94-017-0519-6_48">Ball, Woodrow, and Berry (1987)</a> model is based on the empirical observation that stomatal conductance various roughly linearly with the net photosynthetic flux \(A\) and relative humidity at the leaf surface \(h_s\). They proposed the relationship:</p>
<p class="formulaDsp">
\[g_s = g_{s,0}+a_1A\beta\frac{h_s}{C_s},\]
</p>
<p>where \(C_s\) is the air CO<sub>2</sub> concentration at the leaf surface, and \(g_{s,0}\) and \(a_1\) are empirical parameters. \(\beta\) is a factor to account for reduction in stomatal conductance with soil drying and is defined as</p>
<p class="formulaDsp">
\[\beta = \frac{\theta-\theta_w}{\theta_f-\theta_w},\]
</p>
<p>where \(\theta,\,\theta_f,\,\theta_w\) are the effective soil water content, water content at field capacity, and water content at the wilting point. By default, it is assumed that \(\beta=1\).</p>
<p>This model is at odds with several more recent observation of stomatal function, including: 1) stomata have been shown to respond to the intercellular CO<sub>2</sub> concentration \(C_i\) and not the concentration outside of the leaf <a href="https://academic.oup.com/plphys/article/86/1/200/6082897">(Mott 1988)</a>; 2) stomata respond to the rate of evaporation, not humidity itself <a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1365-3040.1991.tb01521.x?casa_token=FVBmxdVmcYgAAAAA:FKEQjeKvXUSfz2fWQRhMmpi-7TiT8WTPz1pAE6U-PV92CaHLPATox31guMa_bd2ecd_EqwC1XYW-AdhE">(Mott and Parkhurst 1991)</a>; 3) the predicted \(g_s\) value could become negative; 4) the predicted value of \(g_s\) approaches infinity as \(C_s\rightarrow \infty\); 5) the predicted value of \(g_s\) does not respond to soil drying. Another more practical limitation is that photosynthesis must also be modeled in order to calculate stomatal conductance. Nonetheless, this model is one of the most commonly used models of stomatal conductance.</p>
<p>The CO<sub>2</sub> concentration at the leaf surface is calculated as</p>
<p class="formulaDsp">
\[C_s = C_a-\frac{A}{0.75g_{bw}},\]
</p>
<p>where \(0.75g_{bw}\) is the boundary-layer conductance to CO<sub>2</sub> (assuming the diffusivity of CO<sub>2</sub> in air is 0.75 that of water vapor), and \(C_a\) is the air CO<sub>2</sub> concentration outside of the leaf boundary-layer.</p>
<p>The relative humidity at the leaf surface is calculated by setting up a water vapor flux balance at the leaf surface and iteratively solving for the humidity at the leaf surface:</p>
<p class="formulaDsp">
\[g_s*e_{sat}(T_L)*(1-h_s) = g_{bw}*(e_{sat}(T_L)h_s-e_{sat}(T_a)h_a),\]
</p>
<p>where \(e_{sat}(T_L)\) and \(e_{sat}(T_a)\) are the saturated vapor pressure evaluated respectively at the leaf surface and air temperature (calculated according to the <a href="https://en.wikipedia.org/wiki/Tetens_equation">Tetens equation</a>), and \(h_a\) is the air relative humidity outside the leaf boundary-layer.</p>
<p>Below are example parameter values for several different tree crop species (a description of how calibration data was collected is given in the section below). Note that, as mentioned above, in order to apply the model photosynthesis must also be modeled - coefficients for these species are also given in the photosynthesis model documentation.</p>
<table class="doxtable">
<tr>
<th>Species </th><th>\(g_{s,0}\) (mol air/m<sup>2</sup>-s) </th><th>\(a_1\) (unitless) </th><th>\(R^2\) of fit  </th></tr>
<tr>
<td>Almond (default) </td><td>0.0733 </td><td>9.422 </td><td>0.976  </td></tr>
<tr>
<td>Apple </td><td>0.0444 </td><td>7.681 </td><td>0.809  </td></tr>
<tr>
<td>Cherry </td><td>0.0939 </td><td>5.226 </td><td>0.839  </td></tr>
<tr>
<td>Prune </td><td>0.0425 </td><td>7.120 </td><td>0.917  </td></tr>
<tr>
<td>Pear </td><td>0.0775 </td><td>8.298 </td><td>0.928  </td></tr>
<tr>
<td>Pistachio (female) </td><td>0.0647 </td><td>10.732 </td><td>0.956  </td></tr>
<tr>
<td>Pistachio (male) </td><td>0.0419 </td><td>7.580 </td><td>0.953  </td></tr>
<tr>
<td>Walnut </td><td>0.1253 </td><td>5.527 </td><td>0.962  </td></tr>
</table>
<h1><a class="anchor" id="BBLTheory"></a>
Ball-Berry-Leuning Model Theory</h1>
<p><a href="https://link.springer.com/chapter/10.1007/978-94-017-0519-6_48">Leuning et al. (1990,1995)</a> revised the original Ball, Woodrow, Berry model to overcome some of it's original limitations, namely the fact that \(g_s\) approaches infinity as \(C_s\rightarrow \infty\) by calculating stomatal conductance as</p>
<p class="formulaDsp">
\[g_s = g_{s,0}+\frac{a_1A\beta}{\left(C_s-\Gamma\right)\left(1+\frac{D_s}{D_0}\right)},\]
</p>
<p>where \(D_s\) is the vapor pressure deficit between the sub-stomatal cavity and the leaf surface, \(\Gamma\) is the CO<sub>2</sub> compensation point of photosynthesis (including dark respiration), and \(D_0\) (mmol/mol) is an additional empirical parameter.</p>
<p>\(D_s\) is calculated by first determining the surface relative humidity as described above for the Ball, Woodrow, Berry model, then calculating the surface vapor pressure deficit as \(D_s=\frac{e_{sat}(T_L)(1-h_s)}{p_{atm}}\) ( \(p_{atm}\) is atmospheric pressure).</p>
<p>Below are example parameter values for several different tree crop species (a description of how calibration data was collected is given in the section below). Note that, as mentioned above, in order to apply the model photosynthesis must also be modeled - coefficients for these species are also given in the photosynthesis model documentation.</p>
<table class="doxtable">
<tr>
<th>Species </th><th>\(g_{s,0}\) (mol air/m<sup>2</sup>-s) </th><th>\(a_1\) (unitless) </th><th>\(D_0\) (mmol/mol) </th><th>\(R^2\) of fit  </th></tr>
<tr>
<td>Almond (default) </td><td>0.0743 </td><td>4.265 </td><td>14570.0 </td><td>0.984  </td></tr>
<tr>
<td>Apple </td><td>0.0405 </td><td>3.511 </td><td>32950.2 </td><td>0.869  </td></tr>
<tr>
<td>Cherry </td><td>0.0881 </td><td>2.485 </td><td>1578689.7 </td><td>0.947  </td></tr>
<tr>
<td>Prune </td><td>0.0425 </td><td>3.185 </td><td>30488.1 </td><td>0.846  </td></tr>
<tr>
<td>Pear </td><td>0.0814 </td><td>3.718 </td><td>61725.6 </td><td>0.894  </td></tr>
<tr>
<td>Pistachio (female) </td><td>0.0675 </td><td>4.743 </td><td>1566202.4 </td><td>0.971  </td></tr>
<tr>
<td>Pistachio (male) </td><td>0.0465 </td><td>3.370 </td><td>26990.8 </td><td>0.934  </td></tr>
<tr>
<td>Walnut </td><td>0.1248 </td><td>4.548 </td><td>21.4 </td><td>0.977  </td></tr>
</table>
<h1><a class="anchor" id="MoptTheory"></a>
Medlyn et al. (2011) Optimality-Based Model</h1>
<p>The stomatal conductance mode of <a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1365-2486.2010.02375.x">Medlyn et al. (2011)</a> combines the empirical modeling approach with the hypothesis that stomata should act should act to optimally minimize the amount of water used per unit carbon gained.</p>
<p class="formulaDsp">
\[g_s = g_{s,0}+1.6\left(1+\frac{g_1\sqrt{\beta}}{\sqrt{D_s P_{atm}}}\right)\frac{A}{C_s},\]
</p>
<p>where \(D_s\) is in units of mol/mol, and \(P_{atm}\) is atmospheric pressure in kPa. Note that there are a couple of deviations of this equation from that presented in <a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1365-2486.2010.02375.x">Medlyn et al. (2011)</a>: 1) The factor of 1.6 is needed for the resulting conductance to be that of water vapor, 2) We express \(D_s\) in units of mol/mol, and thus multiplication by the atmospheric pressure is needed to get units of kPa, 3) We use surface values for VPD and CO<sub>2</sub> concentration, which allows for incorporation of boundary-layer effects.</p>
<p>One issue with this model is that stomatal conductance blows up to infinity as \(D_s\rightarrow 0\). Our implementation imposes an arbitrary minimum \(D_s\) value of 0.00001 mol/mol.</p>
<p>Below are example parameter values for several different tree crop species (a description of how calibration data was collected is given in the section below). Note that, as mentioned above, in order to apply the model photosynthesis must also be modeled - coefficients for these species are also given in the photosynthesis model documentation.</p>
<table class="doxtable">
<tr>
<th>Species </th><th>\(g_{s,0}\) (mol air/m<sup>2</sup>-s) </th><th>\(g_1\) ( \(\sqrt{kPa}\)) </th><th>\(R^2\) of fit  </th></tr>
<tr>
<td>Almond (default) </td><td>0.0825 </td><td>2.637 </td><td>0.941  </td></tr>
<tr>
<td>Apple </td><td>0.0426 </td><td>2.160 </td><td>0.864  </td></tr>
<tr>
<td>Cherry </td><td>0.0936 </td><td>1.043 </td><td>0.893  </td></tr>
<tr>
<td>Prune </td><td>0.0412 </td><td>1.863 </td><td>0.949  </td></tr>
<tr>
<td>Pear </td><td>0.0775 </td><td>2.418 </td><td>0.966  </td></tr>
<tr>
<td>Pistachio (female) </td><td>0.0756 </td><td>3.252 </td><td>0.902  </td></tr>
<tr>
<td>Pistachio (male) </td><td>0.0434 </td><td>2.039 </td><td>0.941  </td></tr>
<tr>
<td>Walnut </td><td>0.1246 </td><td>1.167 </td><td>0.973  </td></tr>
</table>
<h1><a class="anchor" id="BMFTheory"></a>
Buckley, Mott, Farquhar (2003) Model (simplified version given in Buckley, Turnbull, and Adams 2012)</h1>
<p>The stomatal conductance model of <a href="http://onlinelibrary.wiley.com/doi/10.1111/j.1365-3040.2012.02515.x/full">Buckley, Turnbull, and Adams (2012)</a> is a simplification of the hydromechanical/biochemical model orignially proposed by <a href="https://onlinelibrary.wiley.com/doi/abs/10.1046/j.1365-3040.2003.01094.x">Buckley, Mott, and Farquhar (2003)</a>. The original model is highly complex with many parameters, but with the simplifications described by Buckley, Turnbull, and Adams (2003), an explicit expression for stomatal conductance can be written as</p>
<p class="formulaDsp">
\[g_s = \frac{E_m\beta(Q+i_0)}{k+bQ+(Q+i_0)D_s},\]
</p>
<p>where \(Q\) is the photosynthetic photon flux density, \(D_s\) is defined and calculated as described for other models above, \(E_m,\,i_0,\,k,\) and \(b\) are semi-empirical parameters. Note that the photosynthetic flux that is input to the plug-in is in units of energy flux (W/m<sup>2</sup>), but \(Q\) in this equation is photon flux density ( \(\mu\)mol/m<sup>2</sup>-s). This is because the primitive data value output from the radiation model is in energy flux. The stomatal conductance plug-in automatically converts energy flux to photon flux density using a factor of <a href="https://www.controlledenvironments.org/wp-content/uploads/sites/6/2017/06/Ch01.pdf">4.57 \(\mu\)mol/W</a>.</p>
<p>Below are example parameter values for several different tree crop species (a description of how calibration data was collected is given in the section below).</p>
<table class="doxtable">
<tr>
<th>Species </th><th>\(E_m\) (mmol/m<sup>2</sup>-s) </th><th>\(i_0\) ( \(\mu\)mol/m<sup>2</sup>-s) </th><th>\(k\) ( \(\mu\)mol/m<sup>-2</sup>s<sup>-1</sup> mmol mol<sup>-1</sup>) </th><th>\(b\) (mmol/mol) </th><th>\(R^2\) of fit  </th></tr>
<tr>
<td>Almond (default) </td><td>865.52 </td><td>38.65 </td><td>780320.1 </td><td>2086.07 </td><td>0.991  </td></tr>
<tr>
<td>Apple </td><td>24.82 </td><td>182.86 </td><td>109688.7 </td><td>21.30 </td><td>0.986  </td></tr>
<tr>
<td>Cherry </td><td>138.03 </td><td>154.24 </td><td>262462.7 </td><td>545.59 </td><td>0.963  </td></tr>
<tr>
<td>Prune </td><td>5.47 </td><td>115.73 </td><td>12280.2 </td><td>6.10 </td><td>0.993  </td></tr>
<tr>
<td>Pear </td><td>13.06 </td><td>167.89 </td><td>25926.4 </td><td>9.81 </td><td>0.960  </td></tr>
<tr>
<td>Pistachio (female) </td><td>24865.61 </td><td>171.52 </td><td>63444078.5 </td><td>22428.01 </td><td>0.968  </td></tr>
<tr>
<td>Pistachio (male) </td><td>236.89 </td><td>272.74 </td><td>1224393.7 </td><td>257.26 </td><td>0.964  </td></tr>
<tr>
<td>Walnut </td><td>29.12 </td><td>68.03 </td><td>19778.8 </td><td>75.26 </td><td>0.972  </td></tr>
</table>
<h1><a class="anchor" id="StomatalUse"></a>
Using the Stomatal Conductance Model</h1>
<h2><a class="anchor" id="StomatalCoeffs"></a>
Setting the Model Coefficients</h2>
<p>Each model has a data structure containing member variables for each of the model parameters. These are listed in the table below.</p>
<table class="doxtable">
<tr>
<th>Model </th><th>Parameter Structure  </th></tr>
<tr>
<td>Ball, Woodrow, Berry </td><td><a class="el" href="struct_b_w_bcoefficients.html">BWBcoefficients</a>  </td></tr>
<tr>
<td>Ball, Berry, Leuning </td><td><a class="el" href="struct_b_b_lcoefficients.html">BBLcoefficients</a>  </td></tr>
<tr>
<td>Medlyn et al. Optimality </td><td><a class="el" href="struct_m_o_p_tcoefficients.html">MOPTcoefficients</a>  </td></tr>
<tr>
<td>Buckley, Mott, Farquhar </td><td><a class="el" href="struct_b_m_fcoefficients.html">BMFcoefficients</a>  </td></tr>
</table>
<p>In order to modify model coefficients from the default values, one should 1) declare and instance of the coefficient structure, 2) modify the appropriate data elements of the data structure, and 3) pass the data structure to the <a class="el" href="class_stomatal_conductance_model.html#afbbb0af7d8b3c7966058dbb1289dca13">StomatalConductanceModel::setModelCoefficients()</a> function. Model coefficients can be set to the same value for all primitives, or differently for a subset of primitives based on a vector of UUIDs. Example code is given below</p>
<p><br  />
 </p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="struct_b_m_fcoefficients.html" title="Coefficients for simplified Buckley, Mott, &amp; Farquhar stomatal conductance model.">BMFcoefficients</a> modelcoeffs;</div>
<div class="line">modelcoeffs.Em = 9.3;</div>
<div class="line">modelcoeffs.i0 = 5.3;</div>
<div class="line">modelcoeffs.k = 672;</div>
<div class="line">modelcoeffs.b = 6.7;</div>
</div><!-- fragment --><h2><a class="anchor" id="StomatalRun"></a>
Running the Model (steady-state mode)</h2>
<p>There are two possible functions to run the model: one to run the model for all primitives in the Context (see <a class="el" href="class_stomatal_conductance_model.html#acb041e756e00d5ced85b03905a97f5c6">run()</a>), and another to run the model only for a subset of primitives given their UUIDs (see <a class="el" href="class_stomatal_conductance_model.html#acb041e756e00d5ced85b03905a97f5c6">run()</a>).</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_stomatal_conductance_model_8h.html">StomatalConductanceModel.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>helios;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(){</div>
<div class="line"> </div>
<div class="line">   <span class="comment">//Initialize the Context and add some geometry</span></div>
<div class="line">   <a class="code hl_class" href="classhelios_1_1_context.html" title="Stores the state associated with simulation.">Context</a> context;</div>
<div class="line"> </div>
<div class="line">   context.<a class="code hl_function" href="group__primitives.html#gaf4aec42f3f104b7c71150577ef129659" title="Add new default Patch geometric primitive, which is centered at the origin (0,0,0),...">addPatch</a>( <a class="code hl_function" href="helios__vector__types_8h.html#acff34a9c833707c7aef9618cd19265c5" title="Make a vec3 from three floats.">make_vec3</a>(0,0,0), <a class="code hl_function" href="group__vectors.html#ga2c8ce4551d0597a3aaaf32530233c6fd" title="Make a vec2 from two floats.">make_vec2</a>(1,1) );</div>
<div class="line"> </div>
<div class="line">   <span class="comment">//Initialize the stomatal conductance model</span></div>
<div class="line">   <a class="code hl_class" href="class_stomatal_conductance_model.html">StomatalConductanceModel</a> stomatalmodel( &amp;context );</div>
<div class="line"> </div>
<div class="line">   <span class="comment">//Initialize model coefficients and modify their values</span></div>
<div class="line">   <a class="code hl_struct" href="struct_b_m_fcoefficients.html" title="Coefficients for simplified Buckley, Mott, &amp; Farquhar stomatal conductance model.">BMFcoefficients</a> modelcoeffs;  <span class="comment">//values are initialized with default values</span></div>
<div class="line">   modelcoeffs.Em = 9.3;  <span class="comment">//we can modify one or more parameters</span></div>
<div class="line">   modelcoeffs.i0 = 5.3;</div>
<div class="line">   modelcoeffs.k = 672;</div>
<div class="line">   modelcoeffs.b = 6.7;</div>
<div class="line"> </div>
<div class="line">   stomatalmodel.setModelCoefficients( modelcoeffs );</div>
<div class="line"> </div>
<div class="line">   <span class="comment">//-- Normally you would initialize and run some other models (e.g., radiation, energybalance) here --//</span></div>
<div class="line"> </div>
<div class="line">   <span class="comment">//Run the stomatal conductance model (for all primitives)</span></div>
<div class="line">   stomatalmodel.run();</div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="StomatalRunDyn"></a>
Running the Model in Dynamic Mode</h2>
<p>Any of the above steady-state models can be run in dynamic mode by specifying a timestep and response time constants, which will delay stomatal response to environmental stimuli. When environmental conditions are changed, the stomatal conductance will exponentially relax toward the steady-state value, which is calculated according to any of the above models.</p>
<p>Let the steady-state stomatal conductance value calculated according to any of the above models be denoted by \(g_{s,ss}\). Then the dynamic stomatal conductance is calculated according to the following equation</p>
<p class="formulaDsp">
\[\dfrac{d g_s}{dt} = \dfrac{g_{s,ss} - g_s}{\tau},\]
</p>
<p>where</p>
<p>\(\tau\) is the time constant for stomatal response to a change in environmental conditions, and \(\tau = \tau_{open}\) if stomata are opening, and \(\tau = \tau_{close}\) if stomata are closing.</p>
<p>The above equation can be discretized using a forward Euler scheme to update the stomatal conductance after each timestep \(\Delta t\) as</p>
<p class="formulaDsp">
\[g_s^{new} = g_s^{old} + \dfrac{g_{s,ss} - g_s^{old}}{\tau}\Delta t.\]
</p>
<p>The response time constants \(\tau_{open}\) and \(\tau_{close}\) are specified using the <a class="el" href="class_stomatal_conductance_model.html#a045fd837e2328617901dfd4e15f1da29">StomatalConductanceModel::setDynamicTimeConstants()</a> method. If time constants are not defined, a warning will be issued and the model will run in steady-state mode.</p>
<p>The model also requires an initial stomatal conductance value, which is specified by setting primitive data "moisture_conductance". If this primitive data is not defined, the model will run in steady-state mode for the first timestep, and this steady-state value will become the initial value for running in dynamic mode.</p>
<p>Below is and example of running the model in dynamic mode.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_stomatal_conductance_model_8h.html">StomatalConductanceModel.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>helios;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(){</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//Initialize the Context and add some geometry</span></div>
<div class="line">  <a class="code hl_class" href="classhelios_1_1_context.html" title="Stores the state associated with simulation.">Context</a> context;</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_typedef" href="global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14" title="Unsigned integer type.">uint</a> UUID = context.<a class="code hl_function" href="group__primitives.html#gaf4aec42f3f104b7c71150577ef129659" title="Add new default Patch geometric primitive, which is centered at the origin (0,0,0),...">addPatch</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//Initialize the stomatal conductance model</span></div>
<div class="line">  <a class="code hl_class" href="class_stomatal_conductance_model.html">StomatalConductanceModel</a> stomatalmodel( &amp;context );</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//Initialize model coefficients with default values</span></div>
<div class="line">  <a class="code hl_struct" href="struct_b_m_fcoefficients.html" title="Coefficients for simplified Buckley, Mott, &amp; Farquhar stomatal conductance model.">BMFcoefficients</a> modelcoeffs;  <span class="comment">//values are initialized with default values</span></div>
<div class="line">  stomatalmodel.setModelCoefficients( modelcoeffs );</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//Set the response time constants (seconds)</span></div>
<div class="line">  <span class="keywordtype">float</span> tau_open = 10;</div>
<div class="line">  <span class="keywordtype">float</span> tau_close = 10;</div>
<div class="line">  stomatalmodel.setDynamicTimeConstants(tau_open, tau_close);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//Set the initial stomatal conductance value</span></div>
<div class="line">  <span class="keywordtype">float</span> gs_initial = 0.2f;</div>
<div class="line">  context.<a class="code hl_function" href="classhelios_1_1_context.html#a817fe7d1b8a11f51923d3a7e2c3ba092" title="Add data value (int) associated with a primitive element.">setPrimitiveData</a>( UUID, <span class="stringliteral">&quot;moisture_conductance&quot;</span>, gs_initial );</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">float</span> dt = 1; <span class="comment">//timestep (seconds)</span></div>
<div class="line">  <span class="keywordtype">int</span> Nsteps = 50; <span class="comment">//number of timesteps to run</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span>( <span class="keywordtype">int</span> t=0; t&lt;Nsteps; t++ ){</div>
<div class="line"> </div>
<div class="line">      <span class="comment">//Run the model for each timestep</span></div>
<div class="line">      stomatalmodel.run(dt);</div>
<div class="line"> </div>
<div class="line">      <span class="comment">//Get and print the stomatal conductance value</span></div>
<div class="line">      <span class="keywordtype">float</span> gs_dyn;</div>
<div class="line">      context.<a class="code hl_function" href="classhelios_1_1_context.html#a2144eea981e4030c973287ce2c38315e" title="Get data associated with a primitive element.">getPrimitiveData</a>( UUID, <span class="stringliteral">&quot;moisture_conductance&quot;</span>, gs_dyn );</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;Timestep &quot;</span> &lt;&lt; t &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; gs_dyn &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
