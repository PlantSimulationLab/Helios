<!-- HTML header for doxygen 1.12.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Helios: Energy Balance Model Plugin Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph_link.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript">
  DoxygenAwesomeDarkModeToggle.init()
  DoxygenAwesomeParagraphLink.init()
  DoxygenAwesomeTabs.init()
  DoxygenAwesomeInteractiveToc.init()
</script>
<script>
    try {
        // Remove the stored “last visited page” so the tree always starts fresh
        Cookie.eraseSetting('navpath');
        localStorage.removeItem('navpath');
        // Older Doxygen versions might use this key:
        localStorage.removeItem('nav-sync-path');
        // Force panel synchronization on by default
        localStorage.setItem('navsync', 'true');
        // (fallback for some older builds)
        localStorage.setItem('nav-sync', 'true');
    } catch(e) {
        /* storage unavailable? ignore */
    }
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-93BB4673PE"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-93BB4673PE');
</script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3F0Y5Z6543"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-3F0Y5Z6543');
</script>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="5">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="Helios_logo_small.png"></td>
  <td id="projectalign">
   <div id="projectname">
       <span id="projectnumber">&#160;v1.3.37</span>
   </div>
  </td>
     <td id="searchbox-container">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('_energy_balance_doc.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Energy Balance Model Plugin Documentation</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul>
  <li class="level1">
    <a href="#EBDepends">Dependencies</a>
  </li>
  <li class="level1">
    <a href="#EBissues">Known Issues</a>
  </li>
  <li class="level1">
    <a href="#EBIntro">Introduction</a>
  </li>
  <li class="level1">
    <a href="#EBConstructor">EnergyBalanceModel Class Constructor</a>
  </li>
  <li class="level1">
    <a href="#EBData">Input/Output Primitive Data</a>
    <ul>
      <li class="level2">
        <a href="#EBInputData">Input Primitive Data</a>
      </li>
      <li class="level2">
        <a href="#EBOutputData">Default Output Primitive Data</a>
      </li>
      <li class="level2">
        <a href="#EBOptionalOutputData">Optional Output Primitive Data</a>
      </li>
    </ul>
  </li>
  <li class="level1">
    <a href="#EBUse">Using the Energy Balance Model Plug-in</a>
    <ul>
      <li class="level2">
        <a href="#EBPrimData">Input Variables</a>
      </li>
      <li class="level2">
        <a href="#EBRad">Input Radiative Bands</a>
      </li>
      <li class="level2">
        <a href="#EBblc">Boundary-layer Conductance Model</a>
      </li>
      <li class="level2">
        <a href="#EBgm">Moisture Conductance</a>
      </li>
      <li class="level2">
        <a href="#EBRun">Running the Steady-State Model</a>
        <ul>
          <li class="level3">
            <a href="#EBRunUS">Unsteady model with heat storage</a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
</div>
<div class="textblock"><div class="image">
<img src="EnergyBalance.jpg" alt=""/>
</div>
<p><br  />
<br  />
 </p>
<table class="doxtable">
<tr>
<th>Dependencies </th><td>NVIDIA CUDA 9.0+ </td></tr>
<tr>
<th>CMakeLists.txt </th><td>set( PLUGINS "energybalance" ) </td></tr>
<tr>
<th>Header File </th><td>include "EnergyBalanceModel.h" </td></tr>
<tr>
<th>Class </th><td><a class="el" href="class_energy_balance_model.html">EnergyBalanceModel</a> </td></tr>
</table>
<h1><a class="anchor" id="EBDepends"></a>
Dependencies</h1>
<table class="doxtable">
<tr>
<th>Package </th><td><div class="image">
<img src="apple-logo.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="unix-logo.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="windows-logo.png" alt=""/>
</div>
  </td></tr>
<tr>
<td>NVIDIA CUDA 9.0+ </td><td>Mac OSX: Not available </td><td>Use <a href="https://developer.nvidia.com/cuda-downloads">CUDA installer</a> </td><td>Use <a href="https://developer.nvidia.com/cuda-downloads">CUDA installer</a>  </td></tr>
</table>
<p>For help choosing the correct CUDA toolkit version for your system, consult this page: <a class="el" href="_choosing_c_u_d_a.html">Choosing the right CUDA and OptiX version</a></p>
<p>Useful OS-specific information for installing CUDA can be found here: <a class="el" href="_dependent_software.html">Install and Set-up</a></p>
<p>If you are using a PC, it is likely you will need to increase the GPU timeout in the registry, otherwise calculations lasting longer than 2 secs. will timeout and kill your program. A guide on how to increase the timeout can be found here: <a class="el" href="_p_c_g_p_u_timeout.html">Increasing graphics driver timeout</a></p>
<h1><a class="anchor" id="EBissues"></a>
Known Issues</h1>
<p>None.</p>
<h1><a class="anchor" id="EBIntro"></a>
Introduction</h1>
<p>This model plugin calculates a local energy balance for every primitive, and ultimately predicts sensible, latent, and longwave fluxes as well as surface temperature. The energy balance equation is solved in parallel on the GPU to accelerate calculations.</p>
<p>The model is solving the steady-state budget between absorbed radiation, emitted radiation, sensible heat exchange, and latent heat exchange, which is written as</p>
<p class="formulaDsp">
\[ R-n_s\varepsilon\sigma T_s^4 = c_p g_H \left( T_s-T_a \right) + \lambda g_M \left(\frac{e_s(T_s)f_s-e_s(T_a)h}{p_{atm}}\right)+C_p\frac{dT_s}{dt}+Q_{other}\]
</p>
<p>Variables in this equation are listed in this table:</p>
<table class="doxtable">
<tr>
<th>Variable (units)</th><th>Description </th></tr>
<tr>
<td>\(R\) (W/m<sup>2</sup>)</td><td>Absorbed all-wave radiation flux (shortwave+longwave). </td></tr>
<tr>
<td>\(T_s\) (K)</td><td>Primitive surface temperature. </td></tr>
<tr>
<td>\(T_a\) (K)</td><td>Air temperature just outside primitive boundary-layer. </td></tr>
<tr>
<td>\(g_H\) (mol air/m<sup>2</sup>-s)</td><td>Conductance to heat from primitive surface to outside of boundary-layer. </td></tr>
<tr>
<td>\(g_S\) (mol air/m<sup>2</sup>-s)</td><td>Conductance to moisture between sub-surface air spaces to surface (e.g., for leaves this is stomatal conductance). </td></tr>
<tr>
<td>\(g_M\) (mol air/m<sup>2</sup>-s)</td><td>Conductance to moisture from primitive surface to outside of boundary-layer. </td></tr>
<tr>
<td>\(e_s(T)\) (Pa)</td><td>Saturation vapor pressure at temperature T. Calculated from Tetens equation (see <a href="https://en.wikipedia.org/wiki/Tetens_equation">en.wikipedia.org/wiki/Tetens_equation</a>) </td></tr>
<tr>
<td>\(f_s\)</td><td>Relative humidity of air at primitive surface. </td></tr>
<tr>
<td>\(h\)</td><td>Relative humidity of air outside of boundary-layer. </td></tr>
<tr>
<td>\(p_{atm}\) (Pa)</td><td>Atmospheric pressure. </td></tr>
<tr>
<td>\(C_p\) (J/m<sup>2</sup>/<sup>o</sup>C)</td><td>Heat capacity of object. </td></tr>
<tr>
<td>\(Q_{other}\) (W/m<sup>2</sup>)</td><td>Any surface fluxes other than radiation, convection, or latent (e.g., storage). </td></tr>
<tr>
<td>\(n_s\)</td><td>Number of primitive faces with heat transfer (e.g., typically \(n_s=1\) for leaves, and \(n_s=0\) for the ground. </td></tr>
</table>
<p>Constants are given by:</p>
<table class="doxtable">
<tr>
<th>Constant (units) </th><th>Value </th><th>Description </th></tr>
<tr>
<td>\(c_p\) (J/mol/K) </td><td>29.25 </td><td>Heat capacity of air. </td></tr>
<tr>
<td>\(\lambda\) (J/mol) </td><td>44,000 </td><td>Latent heat of vaporization of air. </td></tr>
</table>
<h1><a class="anchor" id="EBConstructor"></a>
EnergyBalanceModel Class Constructor</h1>
<table class="doxtable">
<tr>
<th>Constructors </th></tr>
<tr>
<td><a class="el" href="class_energy_balance_model.html#ad6c6f535390c7fcb4957a33cfc13b140">EnergyBalanceModel( helios::Context* context)</a> </td></tr>
</table>
<p>The <a class="el" href="class_energy_balance_model.html">EnergyBalanceModel</a> class is initialized by simply passing a pointer to the Helios context as an argument to the constructor.</p>
<h1><a class="anchor" id="EBData"></a>
Input/Output Primitive Data</h1>
<h2><a class="anchor" id="EBInputData"></a>
Input Primitive Data</h2>
<table class="doxtable">
<tr>
<th>Primitive Data </th><th>Units </th><th>Data Type </th><th>Description </th><th>Available Plug-ins </th><th>Default Value </th></tr>
<tr>
<td>radiation_flux_[*] </td><td>W/m<sup>2</sup> </td><td> <font face="courier" color="green">float</font> </td><td>Net absorbed radiation flux for band [*] (e.g., radiation_flux_PAR). </td><td>Can be computed by <a class="el" href="class_radiation_model.html">RadiationModel</a> plug-in. </td><td>N/A (must add at least one band) </td></tr>
<tr>
<td>wind_speed </td><td>m/s </td><td> <font face="courier" color="green">float</font> </td><td>Air wind speed just outside of primitive boundary-layer. </td><td>N/A </td><td>1 m/s </td></tr>
<tr>
<td>object_length </td><td>m </td><td> <font face="courier" color="green">float</font> </td><td>Characteristic dimension of object formed by primitive. </td><td>N/A </td><td>Square root of primitive surface area </td></tr>
<tr>
<td>boundarylayer_conductance</td><td>mol air/m<sup>2</sup>-s </td><td> <font face="courier" color="green">float</font> </td><td>Leaf boundary-layer conductance to heat. </td><td><a class="el" href="class_b_l_conductance_model.html">BLConductanceModel</a> plug-in </td><td>Try calculating from model \(0.135\sqrt{\frac{U}{L}}\) </td></tr>
<tr>
<td>air_temperature </td><td>Kelvin </td><td> <font face="courier" color="green">float</font> </td><td>Ambient air temperature outside of surface boundary layer. </td><td>N/A </td><td>300 K </td></tr>
<tr>
<td>moisture_conductance </td><td>mol air/m<sup>2</sup>-s </td><td> <font face="courier" color="green">float</font> </td><td>Conductance to moisture between sub-surface air spaces and surface (e.g., for leaves this is stomatal conductance). </td><td>Can be computed by <a class="el" href="class_stomatal_conductance_model.html">StomatalConductanceModel</a> plug-in. </td><td>0 </td></tr>
<tr>
<td>surface_humidity </td><td>unitless </td><td> <font face="courier" color="green">float</font> </td><td>Relative humidity of air immediately above surface evaporating site. </td><td>N/A </td><td>1.0 (saturated) </td></tr>
<tr>
<td>air_humidity </td><td>unitless </td><td> <font face="courier" color="green">float</font> </td><td>Ambient air relative humidity outside of surface boundary layer. </td><td>N/A </td><td>0.5 </td></tr>
<tr>
<td>air_pressure </td><td>Pascals </td><td> <font face="courier" color="green">float</font> </td><td>Atmospheric pressure. </td><td>N/A </td><td>101,000 Pa </td></tr>
<tr>
<td>heat_capacity </td><td>J/m<sup>2</sup>/<sup>o</sup>C </td><td> <font face="courier" color="green">float</font> </td><td>Heat capacity of object. </td><td>N/A </td><td>0 </td></tr>
<tr>
<td>other_surface_flux </td><td>W/m<sup>2</sup> </td><td> <font face="courier" color="green">float</font> </td><td>Other surface energy fluxes. </td><td>N/A </td><td>0 </td></tr>
<tr>
<td>twosided_flag </td><td>N/A </td><td> <font face="courier" color="green">uint</font> </td><td>Flag indicating the number of primitive faces with heat transfer (twosided_flag = 0 for one-sided heat transfer; twosided_flag = 1 for two-sided heat transfer). </td><td>N/A </td><td>1  </td></tr>
<tr>
<td>stomatal_sidedness </td><td>\(\zeta\) </td><td> <font face="courier" color="green">float</font> </td><td>Ratio of stomatal density on the upper leaf surface to the sum of the stomatal density on upper and lower leaf surfaces. Note: if "twosided_flag" is equal to 0, stomatal_sidedness will be automatically set to 0.</td><td>N/A </td><td>0  </td></tr>
</table>
<h2><a class="anchor" id="EBOutputData"></a>
Default Output Primitive Data</h2>
<table class="doxtable">
<tr>
<th>Primitive Data </th><th>Units </th><th>Data Type </th><th>Description </th></tr>
<tr>
<td>temperature </td><td>Kelvin </td><td> <font face="courier" color="green">float</font> </td><td>Primitive surface temperature. </td></tr>
<tr>
<td>sensible_flux </td><td>W/m<sup>2</sup> </td><td> <font face="courier" color="green">float</font> </td><td>Sensible heat flux. </td></tr>
<tr>
<td>latent_flux </td><td>W/m<sup>2</sup> </td><td> <font face="courier" color="green">float</font> </td><td>Latent heat flux. </td></tr>
</table>
<h2><a class="anchor" id="EBOptionalOutputData"></a>
Optional Output Primitive Data</h2>
<table class="doxtable">
<tr>
<th>Primitive Data </th><th>Units </th><th>Data Type </th><th>Description </th></tr>
<tr>
<td>boundarylayer_conductance_out </td><td>mol air/m<sup>2</sup>-s </td><td> <font face="courier" color="green">float</font> </td><td>Primitive boundary-layer conductance calculated by this plug-in. </td></tr>
<tr>
<td>vapor_pressure_deficit </td><td>mol/mol </td><td> <font face="courier" color="green">float</font> </td><td>Surface vapor pressure deficit. </td></tr>
<tr>
<td>storage_flux </td><td>W/m<sup>2</sup> </td><td> <font face="courier" color="green">float</font> </td><td>Storage heat flux. </td></tr>
<tr>
<td>net_radiation_flux </td><td>W/m<sup>2</sup> </td><td> <font face="courier" color="green">float</font> </td><td>Primitive net radiation flux (absorption minus emission). </td></tr>
</table>
<h1><a class="anchor" id="EBUse"></a>
Using the Energy Balance Model Plug-in</h1>
<h2><a class="anchor" id="EBPrimData"></a>
Input Variables</h2>
<p>Inputs to the model are set by creating primitive variable data in the usual way. If a variable needed for a model input has not been create in the Context, the default value is assumed.</p>
<h2><a class="anchor" id="EBRad"></a>
Input Radiative Bands</h2>
<p>In order for the model to calculate the absorbed all-wave radiation flux, it needs to know the names of all radiation bands that were added to the radiation model. This is done using the function <a class="el" href="class_energy_balance_model.html#a7ce12c9b4baf734d49562fe45e7eb272">addRadiationBand()</a>. In the following example, assume we have three radiative wavebands "PAR", "NIR", and "LW".</p>
<div class="fragment"><div class="line"><span class="comment">// Initialize the Model</span></div>
<div class="line"><a class="code hl_class" href="class_energy_balance_model.html" title="Energy balance model class.">EnergyBalanceModel</a> energybalance(&amp;context);</div>
<div class="line"> </div>
<div class="line">energybalance.addRadiationBand(<span class="stringliteral">&quot;PAR&quot;</span>);</div>
<div class="line">energybalance.addRadiationBand(<span class="stringliteral">&quot;NIR&quot;</span>);</div>
<div class="line">energybalance.addRadiationBand(<span class="stringliteral">&quot;LW&quot;</span>);</div>
</div><!-- fragment --><h2><a class="anchor" id="EBblc"></a>
Boundary-layer Conductance Model</h2>
<p>The primitive boundary-layer conductance can either be set using the <a class="el" href="class_b_l_conductance_model.html">BLConductanceModel</a> plug-in, or using the default model which is the Polhausen equation. Note also that custom conductance values can also be provided by setting the value of primitive data labeled 'boundarylayer_conductance', which overrides the computed model value.</p>
<p>It is also important to note that, by default, the length scale used to calculate the boundary-layer conductance is taken to be the square root of the primitive surface area. If the size of the object is different from the size of the primitive, then it is important to manually set the length scale to be the size of the object, as this is the relevant scale for boundary-layer development.</p>
<p>The default boundary-layer conductance is calculated as</p>
<p>\(g_H = 0.135 n_s\sqrt{\frac{U}{L}}\),</p>
<p>where \(U\) is the wind speed just outside of the primitive boundary-layer, and \(L\) is the characteristic length/dimension of the object that the primitive belongs to. For a leaf consisting of a single primitive, \(L\) could be assumed to be the length of the primitive. \(n_s\) is the number of primitive faces, which is determined by the value of primitive data "twosided_flag" (twosided_flag=0 is single-sided and \(n_s=1\), twosided_flag=1 is two-sided and \(n_s=2\)).</p>
<h2><a class="anchor" id="EBgm"></a>
Moisture Conductance</h2>
<p>For surfaces that are not completely dry or completely saturated with water, availability of water at the surface determines the rate of moisture transfer from the surface. This is represented by the surface moisture conductance \(g_S\), and corresponds to the conductance between the sub-surface air spaces and the surface.</p>
<p>For a dry surface, \(g_S=0\) and thus there is no moisture transfer at the surface. For a surface that is saturated with water (e.g., a lake, puddle), \(g_S\rightarrow\infty\) as the supply of water at the surface is theoretically infinite.</p>
<p>For surfaces such as leaves and the soil in which surface moisture is present but limited, \(g_S\) will have some intermediate value typically on the order of 0.1 mol air/m<sup>2</sup>-s.</p>
<p>For leaves, \(g_S\) corresponds to the conductance to water vapor between the intercellular (sub-stomatal) air spaces and the surface of the leaf, which we call the stomatal conductance. When stomata are closed, \(g_S\rightarrow 0\), as water transfer is restricted by the stomata.</p>
<p>For the soil surface, the physical interpretation of \(g_S\) is slightly less intuitive, and corresponds to the rate at which water vapor can diffuse from just below the soil to the surface. This is impacted by the soil texture, and the "tortuosity" of the path water vapor must take through the soil, among other factors.</p>
<p>Once the water vapor has diffused to the surface, the rate of transfer is then determined by the surface boundary-layer conductance. The sub-surface conductance and boundary-layer conductance act in serial, and can be combined to yield an overall moisture conductance between the sub-surface air spaces and the outside of the boundary layer according to</p>
<p>\(g_M = 1.08g_Hg_S\left[\dfrac{\zeta}{1.08g_H+g_S\zeta}+\dfrac{(1-\zeta)}{1.08g_H+g_S(1-\zeta)}\right]\),</p>
<p>where \(g_H\) is the boundary-layer conductance to heat, and \(1.08g_H\) gives the boundary-layer conductance to moisture considering the differences in diffusivity between water vapor and heat.</p>
<p>\(\zeta=\dfrac{D_{upper}}{D_{lower}+D_{upper}}\)</p>
<p>is the stomatal sidedness, which is the ratio of the stomatal density of the upper leaf surface to the sum of the upper and lower leaf surface densities, which is set by the primitive data value "stomatal_sidedness". For leaves, \(\zeta=0\) corresponds to hypostomatous leaves (stomata on one side), and \(\zeta=0.5\) to amphistomatous leaves (stomata equally on both sides). It is important to note that if \(n_s=1\), then the value of \(\zeta\) will be overridden and set to 0.</p>
<h2><a class="anchor" id="EBRun"></a>
Running the Steady-State Model</h2>
<p>The model is run assuming steady-state conditions (heat storage term is zero) using the <a class="el" href="class_energy_balance_model.html#aaee8cda49702db14f26e26bddaf3c16a">EnergyBalanceModel::run()</a> function, which will run the model for all primitives in the Context if no argument is given, or will run the model for a subset of primitives if a vector of UUIDs is given as the argument.</p>
<table class="doxtable">
<caption>Functions to run the steady-state energy balance model.</caption>
<tr>
<th>Model Run Function </th><th>Description </th></tr>
<tr>
<td><a class="el" href="class_energy_balance_model.html#aaee8cda49702db14f26e26bddaf3c16a">EnergyBalanceModel::run( void )</a> </td><td>Run the model for all primitives in the Context. </td></tr>
<tr>
<td><a class="el" href="class_energy_balance_model.html#a2053c71e6ae107ba6ba612c56b245cf4">EnergyBalanceModel::run( const std::vector&lt;uint&gt; &amp;UUIDs )</a> </td><td>Run the model for a select set of primitives in the Context, which are specified by a vector of their UUIDs. </td></tr>
</table>
<p><br  />
<br  />
 </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_energy_balance_model_8h.html">EnergyBalanceModel.h</a>&quot;</span></div>
<div class="line"><span class="keyword">using namespace </span>helios;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(){</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Initialize the Context</span></div>
<div class="line">    <a class="code hl_class" href="classhelios_1_1_context.html" title="Stores the state associated with simulation.">Context</a> context;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Add `Patch&#39; primitive</span></div>
<div class="line">    <a class="code hl_struct" href="structhelios_1_1vec3.html" title="Vector of three elements of type &#39;float&#39;.">vec3</a> center = <a class="code hl_function" href="helios__vector__types_8h.html#acff34a9c833707c7aef9618cd19265c5" title="Make a vec3 from three floats.">make_vec3</a>(0,0,1);</div>
<div class="line">    <a class="code hl_struct" href="structhelios_1_1vec2.html" title="Vector of two elements of type &#39;float&#39;.">vec2</a> size = <a class="code hl_function" href="group__vectors.html#ga2c8ce4551d0597a3aaaf32530233c6fd" title="Make a vec2 from two floats.">make_vec2</a>(1,1);</div>
<div class="line">    <a class="code hl_typedef" href="global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14" title="Unsigned integer type.">uint</a> UUID = context.<a class="code hl_function" href="group__primitives.html#gaf4aec42f3f104b7c71150577ef129659" title="Add new default Patch geometric primitive, which is centered at the origin (0,0,0),...">addPatch</a>( center, size );</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="class_energy_balance_model.html" title="Energy balance model class.">EnergyBalanceModel</a> energybalance(&amp;context);</div>
<div class="line"> </div>
<div class="line">    energybalance.addRadiationBand(<span class="stringliteral">&quot;PAR&quot;</span>);</div>
<div class="line">    energybalance.addRadiationBand(<span class="stringliteral">&quot;NIR&quot;</span>);</div>
<div class="line">    energybalance.addRadiationBand(<span class="stringliteral">&quot;LW&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    energybalance.run();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="EBRunUS"></a>
Unsteady model with heat storage</h3>
<p>Additional functions are available to run the unsteady energy balance model with heat storage. If the timestep argument "dt" is passed with value greater than 0, and the heat capacity \(C_p\) is greater than 0, the unsteady energy balance equation will be applied with the heat storage term included. The following equation is then solved for the surface temperature at time \(t+\Delta t\)</p>
<p class="formulaDsp">
\[ R-n_s\varepsilon\sigma T_s(t+\Delta t)^4 - c_p g_H \left( T_s(t+\Delta t)-T_a \right) - \lambda g_M \left(\frac{e_s(T_s(t+\Delta t))f_s-e_s(T_a)h}{p_{atm}}\right)-Q_{other} + C_p\dfrac{T_s(t+\Delta t) - T_s(t)}{\Delta t}.\]
</p>
<p>The timestep should be chosen such that it is significantly smaller than the characteristic time constant of heat storage.</p>
<p>Functions for running the unsteady energy balance model are listed below.</p>
<table class="doxtable">
<caption>Functions to run the unsteady energy balance model.</caption>
<tr>
<th>Model Run Function </th><th>Description </th></tr>
<tr>
<td><a class="el" href="class_energy_balance_model.html#a5048dec148d795d76d10d331bdb35156">EnergyBalanceModel::run( float dt )</a> </td><td>Run the model for all primitives in the Context and advance in time by dt seconds. </td></tr>
<tr>
<td><a class="el" href="class_energy_balance_model.html#a4accc5ed86460c662db1352ef1857e0c">EnergyBalanceModel::run( const std::vector&lt;uint&gt; &amp;UUIDs, float dt )</a> </td><td>Run the model for a select set of primitives in the Context, which are specified by a vector of their UUIDs, and advance in time by dt seconds. </td></tr>
</table>
<p>Note that you can run the steady-state model for some primitives but run the unsteady model for others simply by changing the value of the heat capacity primitive data. This is illustrated in the code example below.</p>
<p><br  />
<br  />
 </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_energy_balance_model_8h.html">EnergyBalanceModel.h</a>&quot;</span></div>
<div class="line"><span class="keyword">using namespace </span>helios;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(){</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Initialize the Context</span></div>
<div class="line">   <a class="code hl_class" href="classhelios_1_1_context.html" title="Stores the state associated with simulation.">Context</a> context;</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Add one &#39;Patch&#39; primitive</span></div>
<div class="line">   <a class="code hl_struct" href="structhelios_1_1vec3.html" title="Vector of three elements of type &#39;float&#39;.">vec3</a> center = <a class="code hl_function" href="helios__vector__types_8h.html#acff34a9c833707c7aef9618cd19265c5" title="Make a vec3 from three floats.">make_vec3</a>(0,0,1);</div>
<div class="line">   <a class="code hl_struct" href="structhelios_1_1vec2.html" title="Vector of two elements of type &#39;float&#39;.">vec2</a> size = <a class="code hl_function" href="group__vectors.html#ga2c8ce4551d0597a3aaaf32530233c6fd" title="Make a vec2 from two floats.">make_vec2</a>(1,1);</div>
<div class="line">   <a class="code hl_typedef" href="global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14" title="Unsigned integer type.">uint</a> UUID1 = context.<a class="code hl_function" href="group__primitives.html#gaf4aec42f3f104b7c71150577ef129659" title="Add new default Patch geometric primitive, which is centered at the origin (0,0,0),...">addPatch</a>( center, size );</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Add a second `Patch&#39; primitive</span></div>
<div class="line">   center = <a class="code hl_function" href="helios__vector__types_8h.html#acff34a9c833707c7aef9618cd19265c5" title="Make a vec3 from three floats.">make_vec3</a>(2,0,1);</div>
<div class="line">   <a class="code hl_typedef" href="global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14" title="Unsigned integer type.">uint</a> UUID2 = context.<a class="code hl_function" href="group__primitives.html#gaf4aec42f3f104b7c71150577ef129659" title="Add new default Patch geometric primitive, which is centered at the origin (0,0,0),...">addPatch</a>( center, size );</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Set the heat capacity of the first patch so that the unsteady energy balance model will be run</span></div>
<div class="line">   <span class="keywordtype">float</span> Cp = 10000; <span class="comment">//J/m^2-oC</span></div>
<div class="line">   context.<a class="code hl_function" href="classhelios_1_1_context.html#a817fe7d1b8a11f51923d3a7e2c3ba092" title="Add data value (int) associated with a primitive element.">setPrimitiveData</a>( UUID1, <span class="stringliteral">&quot;heat_capacity&quot;</span>, Cp );</div>
<div class="line"> </div>
<div class="line">   <a class="code hl_class" href="class_energy_balance_model.html" title="Energy balance model class.">EnergyBalanceModel</a> energybalance(&amp;context);</div>
<div class="line"> </div>
<div class="line">   energybalance.addRadiationBand(<span class="stringliteral">&quot;PAR&quot;</span>);</div>
<div class="line">   energybalance.addRadiationBand(<span class="stringliteral">&quot;NIR&quot;</span>);</div>
<div class="line">   energybalance.addRadiationBand(<span class="stringliteral">&quot;LW&quot;</span>);</div>
<div class="line"> </div>
<div class="line">   <span class="keywordtype">float</span> dt = 180;</div>
<div class="line">   energybalance.run( dt );</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
