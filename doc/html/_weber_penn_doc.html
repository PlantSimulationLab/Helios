<!-- HTML header for doxygen 1.12.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Helios: Weber-Penn Tree Plugin Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph_link.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript">
  DoxygenAwesomeDarkModeToggle.init()
  DoxygenAwesomeParagraphLink.init()
  DoxygenAwesomeTabs.init()
  DoxygenAwesomeInteractiveToc.init()
</script>
<script>
    try {
        // Remove the stored “last visited page” so the tree always starts fresh
        Cookie.eraseSetting('navpath');
        localStorage.removeItem('navpath');
        // Older Doxygen versions might use this key:
        localStorage.removeItem('nav-sync-path');
        // Force panel synchronization on by default
        localStorage.setItem('navsync', 'true');
        // (fallback for some older builds)
        localStorage.setItem('nav-sync', 'true');
    } catch(e) {
        /* storage unavailable? ignore */
    }
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-93BB4673PE"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-93BB4673PE');
</script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3F0Y5Z6543"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-3F0Y5Z6543');
</script>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="5">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="Helios_logo_small.png"></td>
  <td id="projectalign">
   <div id="projectname">
       <span id="projectnumber">&#160;v1.3.37</span>
   </div>
  </td>
     <td id="searchbox-container">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('_weber_penn_doc.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Weber-Penn Tree Plugin Documentation</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul>
  <li class="level1">
    <a href="#WPTissues">Known Issues</a>
  </li>
  <li class="level1">
    <a href="#WPTreeIntro">Introduction</a>
  </li>
  <li class="level1">
    <a href="#WPTConstructor">WeberPennTree Class Constructor</a>
  </li>
  <li class="level1">
    <a href="#WPTreeUse">Using the Weber-Penn Tree Plug-in</a>
    <ul>
      <li class="level2">
        <a href="#WPTLibrary">The XML Tree Library File</a>
      </li>
      <li class="level2">
        <a href="#WPTadd">Adding Trees from the Tree Library</a>
      </li>
      <li class="level2">
        <a href="#WPTCustom">Custom Tree Library Files</a>
      </li>
    </ul>
  </li>
  <li class="level1">
    <a href="#WPTreeXML">Creating Custom XML Files</a>
    <ul>
      <li class="level2">
        <a href="#WPTOverview">General Overview</a>
      </li>
      <li class="level2">
        <a href="#WPTreeShape">Trunk and general tree shape</a>
      </li>
      <li class="level2">
        <a href="#WPTreeR1">Recursive Branches</a>
      </li>
      <li class="level2">
        <a href="#WPTreeLeaves">Leaves</a>
        <ul>
          <li class="level3">
            <a href="#WPTreeMask">Leaf mask</a>
          </li>
        </ul>
      </li>
      <li class="level2">
        <a href="#WPTgL">User-Defined Leaf Angle Distribution Functions</a>
      </li>
    </ul>
  </li>
</ul>
</div>
<div class="textblock"><div class="image">
<img src="AlmondOrchard.png" alt=""/>
</div>
<p><br  />
<br  />
 </p>
<table class="doxtable">
<tr>
<th>Dependencies</th><td>None. </td></tr>
<tr>
<th>CMakeLists.txt</th><td>set( PLUGINS "weberpenntree" ) </td></tr>
<tr>
<th>Header File</th><td>include "WeberPennTree.h" </td></tr>
<tr>
<th>Class</th><td><a class="el" href="class_weber_penn_tree.html">WeberPennTree</a> </td></tr>
</table>
<h1><a class="anchor" id="WPTissues"></a>
Known Issues</h1>
<ul>
<li>The following parameters described in Weber and Penn (1995) are not implemented: nCurveBack, Flare.</li>
</ul>
<h1><a class="anchor" id="WPTreeIntro"></a>
Introduction</h1>
<p>This plugin implements the Weber-Penn 3D procedural tree generation model, which generates a 3D leaf- and branch-resolved model of a tree. Click <a href="http://dl.acm.org/citation.cfm?id=218427">here</a> for the publication describing the model. The method has many different parameters that can be adjusted to create arbitrary tree architectures. The plugin adds geometric primitives to the Helios context that defines the geometry of the generated tree.</p>
<h1><a class="anchor" id="WPTConstructor"></a>
WeberPennTree Class Constructor</h1>
<table class="doxtable">
<tr>
<th>Constructors </th></tr>
<tr>
<td><a class="el" href="class_weber_penn_tree.html#a5b949a2008b9e4817f2df4b5861c49b5">WeberPennTree( helios::Context* context)</a> </td></tr>
</table>
<p>The <a class="el" href="class_weber_penn_tree.html">WeberPennTree</a> class is initialized by simply passing a pointer to the Helios context as an argument to the constructor. This gives the class the ability to automatically add geometry to the context.</p>
<h1><a class="anchor" id="WPTreeUse"></a>
Using the Weber-Penn Tree Plug-in</h1>
<h2><a class="anchor" id="WPTLibrary"></a>
The XML Tree Library File</h2>
<p>The parameters that define various tree geometries are specified in an XML file, which is loaded by the plug-in. When the WeberPennTree constructor is called, the defalut tree library is loaded. A list of trees in the default library is listed in the table below. Default tree parameters can be modified by the user, or custom tree libraries can be added, which is detailed in Section <a class="el" href="#WPTCustom">Custom Tree Library Files</a>. An example tree definition is given below. The tree definition is encapsulated by the &lt;WeberPennTree label="..."&gt;...&lt;/WeberPennTree&gt; tag, where label gives a handle used to reference that specific tree geometry. Other tags define various parameters that determine the structure of the tree, which are detailed in the sections below.</p>
<table class="doxtable">
<tr>
<th>Tree type</th><th>Sample Image </th></tr>
<tr>
<td>Almond</td><td><div class="image">
<img src="Almond.jpeg" alt=""/>
</div>
 </td></tr>
<tr>
<td>Apple</td><td><div class="image">
<img src="Apple.jpeg" alt=""/>
</div>
 </td></tr>
<tr>
<td>Avocado</td><td><div class="image">
<img src="Avocado.jpeg" alt=""/>
</div>
 </td></tr>
<tr>
<td>Lemon</td><td><div class="image">
<img src="Lemon.jpeg" alt=""/>
</div>
 </td></tr>
<tr>
<td>Olive</td><td><div class="image">
<img src="Olive.jpeg" alt=""/>
</div>
 </td></tr>
<tr>
<td>Orange</td><td><div class="image">
<img src="Orange.jpeg" alt=""/>
</div>
 </td></tr>
<tr>
<td>Peach</td><td><div class="image">
<img src="Peach.jpeg" alt=""/>
</div>
 </td></tr>
<tr>
<td>Pistachio</td><td><div class="image">
<img src="Pistachio.jpeg" alt=""/>
</div>
 </td></tr>
<tr>
<td>Walnut</td><td><div class="image">
<img src="Walnut.jpeg" alt=""/>
</div>
 </td></tr>
</table>
<div class="fragment"><div class="line">&lt;?xml version=1.0?&gt;</div>
<div class="line"> </div>
<div class="line">&lt;helios&gt;</div>
<div class="line"> </div>
<div class="line">  &lt;<a class="code hl_class" href="class_weber_penn_tree.html">WeberPennTree</a> label=<span class="stringliteral">&quot;Almond&quot;</span>&gt;</div>
<div class="line">    &lt;Shape&gt; 3 &lt;/Shape&gt;</div>
<div class="line">    &lt;BaseSize&gt; 0.2 &lt;/BaseSize&gt;</div>
<div class="line">    &lt;BaseSplits&gt; 2 &lt;/BaseSplits&gt;</div>
<div class="line">    &lt;BaseSplitSize&gt; 0.2 &lt;/BaseSplitSize&gt;</div>
<div class="line">    &lt;Scale&gt; 6 &lt;/Scale&gt;</div>
<div class="line">    &lt;ScaleV&gt; 1 &lt;/ScaleV&gt;</div>
<div class="line">    &lt;ZScale&gt; 1 &lt;/ZScale&gt;</div>
<div class="line">    &lt;ZScaleV&gt; 0 &lt;/ZScaleV&gt;</div>
<div class="line">    &lt;Ratio&gt; 0.02 &lt;/Ratio&gt;</div>
<div class="line">    &lt;RatioPower&gt; 1.3 &lt;/RatioPower&gt;</div>
<div class="line">    &lt;Lobes&gt; 5 &lt;/Lobes&gt;</div>
<div class="line">    &lt;LobeDepth&gt; 0.1 &lt;/LobeDepth&gt;</div>
<div class="line">    &lt;Flare&gt; 0.25 &lt;/Flare&gt;</div>
<div class="line">    &lt;Levels&gt; 3 &lt;/Levels&gt;</div>
<div class="line">    &lt;nSegSplits&gt; 0 0 0 0 &lt;/nSegSplits&gt;</div>
<div class="line">    &lt;nSplitAngle&gt; 40 10 10 0 &lt;/nSplitAngle&gt;</div>
<div class="line">    &lt;nSplitAngleV&gt; 0 0 0 0 &lt;/nSplitAngleV&gt;</div>
<div class="line">    &lt;nCurveRes&gt; 8 5 3 1 &lt;/nCurveRes&gt;</div>
<div class="line">    &lt;nCurve&gt; -60 -40 10 &lt;/nCurve&gt;</div>
<div class="line">    &lt;nCurveV&gt; 0 0 0 0 &lt;/nCurveV&gt;</div>
<div class="line">    &lt;nCurveBack&gt; 0 -70 0 0 &lt;/nCurveBack&gt;</div>
<div class="line">    &lt;nLength&gt; 1 0.6 0.4 0.3 &lt;/nLength&gt;</div>
<div class="line">    &lt;nLengthV&gt; 0 0 0 0 &lt;/nLengthV&gt;</div>
<div class="line">    &lt;nTaper&gt; 1 1 1 1 &lt;/nTaper&gt;</div>
<div class="line">    &lt;nDownAngle&gt; 0 50 30 0 &lt;/nDownAngle&gt;</div>
<div class="line">    &lt;nDownAngleV&gt; 0 0 0 0 &lt;/nDownAngleV&gt;</div>
<div class="line">    &lt;nRotate&gt; 95 95 95 95 &lt;/nRotate&gt;</div>
<div class="line">    &lt;nRotateV&gt; 0 10 10 0 &lt;/nRotateV&gt;</div>
<div class="line">    &lt;nBranches&gt; 0 50 30 20 &lt;/nBranches&gt;</div>
<div class="line">    &lt;Leaves&gt; 16 &lt;/Leaves&gt;</div>
<div class="line">    &lt;LeafFile&gt; plugins/weberpenntree/leaves/AlmondLeaf.png &lt;/LeafFile&gt;</div>
<div class="line">    &lt;LeafScale&gt; 0.2 &lt;/LeafScale&gt;</div>
<div class="line">    &lt;LeafScaleX&gt; 0.3 &lt;/LeafScaleX&gt;</div>
<div class="line">    &lt;WoodFile&gt; plugins/visualizer/textures/wood2.jpg &lt;/WoodFile&gt;</div>
<div class="line">  &lt;/<a class="code hl_class" href="class_weber_penn_tree.html">WeberPennTree</a>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;/helios&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="WPTadd"></a>
Adding Trees from the Tree Library</h2>
<p>The WeberPennTree member function <a class="el" href="class_weber_penn_tree.html#a49f706c54cbf91ea5c40fb247d4e3559">WeberPennTree::buildTree()</a> is used to add and instance of a tree from the library. This function takes two required arguments in addition to one optional argument. The user must specify 1) the label for the tree as defined in the tree library XML file (see above), and 2) the (x,y,z) position to place the tree (note that this position is with respect to the base of the trunk). A third optional argument specifies a scaling factor to apply to the tree, where scale&lt;1 makes the tree smaller, and scale&gt;1 makes the tree bigger. The <a class="el" href="class_weber_penn_tree.html#a49f706c54cbf91ea5c40fb247d4e3559">WeberPennTree::buildTree</a> function returns a uint that gives an identifier for the particular instance of the tree. This can be used later to reference the tree.</p>
<p>The tree building process involves adding primitives to the Helios context that comprise a particular tree geometry. The UUIDs for the primitives that comprise trees can be queried via the functions <a class="el" href="class_weber_penn_tree.html#ab247d9368368263dfdded18a43917f98">WeberPennTree::getTrunkUUIDs()</a>, <a class="el" href="class_weber_penn_tree.html#a813cb8959272b535050dc97aa49d3ed3">WeberPennTree::getBranchUUIDs()</a>, and <a class="el" href="class_weber_penn_tree.html#af4368c1f900503f6d72f0c0e569fe8e5">WeberPennTree::getLeafUUIDs()</a> along with the identifier of the tree.</p>
<table class="doxtable">
<tr>
<th>Tree Building Functions </th></tr>
<tr>
<td><a class="el" href="class_weber_penn_tree.html#a49f706c54cbf91ea5c40fb247d4e3559">uint buildTree( const char* treename, helios::vec3 origin )</a> </td></tr>
<tr>
<td><a class="el" href="class_weber_penn_tree.html#af1dc9499df0c1cc26f3d0c5782da10bd">uint buildTree( const char* treename, helios::vec3 origin, float scale )</a> </td></tr>
</table>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_context_8h.html">Context.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_weber_penn_tree_8h.html">WeberPennTree.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(){</div>
<div class="line">    Context context; <span class="comment">//declare the context</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">//create an instance of the WeberPennTree class, which we will call &quot;weberpenntree&quot;</span></div>
<div class="line">    <a class="code hl_class" href="class_weber_penn_tree.html">WeberPennTree</a> weberpenntree( &amp;context );</div>
<div class="line">    </div>
<div class="line">    <span class="comment">//Create an almond tree at the point (0,0,0)</span></div>
<div class="line">    <a class="code hl_typedef" href="global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14" title="Unsigned integer type.">uint</a> ID_almond = weberpenntree.buildTree( <span class="stringliteral">&quot;Almond&quot;</span>, make_vec3(0,0,0) );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//Create an orange tree at the point (10,0,0)</span></div>
<div class="line">    <a class="code hl_typedef" href="global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14" title="Unsigned integer type.">uint</a> ID_orange = weberpenntree.buildTree( <span class="stringliteral">&quot;Orange&quot;</span>, make_vec3(10,0,0) );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//Retrieve UUIDs for context primitives making up the almond tree&#39;s leaves</span></div>
<div class="line">    std::vector&lt;uint&gt; leafUUIDs_almond = weberpenntree.getLeafUUIDs( ID_almond );</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="WPTCustom"></a>
Custom Tree Library Files</h2>
<p>User-specified XML tree library files can be utilized via the <a class="el" href="class_weber_penn_tree.html#a3cc9a0c0b3039e5fa44fc77a117a72dc">WeberPennTree::loadXML()</a> function. The argument to this function is an absolute or relative path to the XML file to be loaded. Note that as always relative file paths are relative to the project's build directory.</p>
<h1><a class="anchor" id="WPTreeXML"></a>
Creating Custom XML Files</h1>
<h2><a class="anchor" id="WPTOverview"></a>
General Overview</h2>
<div class="image">
<img src="Sketch_RLevels.jpeg" alt=""/>
</div>
<p>The general idea behind the tree geometries is by specifying parameters that define the growth pattern of recursive branching levels (see figure above). The base structure of the tree is the trunk, which is the 0th recursive level. Braches are considered "children" of their "parent", which in this case is the trunk. The first branching level is dependent on the size and orientation of the trunk. Further levels of recursion are created by generating branches that are children of the previous branching level. Each branching level follows the same set of rules but has different parameters that define the way they grow. The number of recursion levels is given by the parameter <b>Levels</b>. Importantly, the last level of recursion always corresponds to leaves, which follows the same general rules as branches. So setting Levels = 3 would give a trunk, two branching levels, plus leaves.</p>
<p>Many parameter names are prepended with the letter "n", which indicates that these parameters vary with recursion level. For example, the parameter <b>Scale</b> is a scaling factor applied to the whole tree, and thus it does not depend on the recursion level. The parameter <b>nBraches</b> gives the maximum number of branches <b>for each recursion level</b> (note the "n" in the name), and therefore can have a different value for each recursion level. Below, each recursion level will be referred to by replacing "n" by the level number (e.g., 0Branches, 1Branches, 2Branches, etc.).</p>
<p>Many parameter names are appended with the letter "V", which indicates that the parameter indicates a random range over which a value varies. For example, if Scale = 10 and ScaleV = 1, the scale factor would randomly vary between 9 and 11. Setting ScaleV to 0 would mean that there is no variation and the scale factor is always 10.</p>
<h2><a class="anchor" id="WPTreeShape"></a>
Trunk and general tree shape</h2>
<div class="image">
<img src="Sketch_0Trunk.jpeg" alt=""/>
</div>
<table class="doxtable">
<caption>Parameters related to the trunk and overall tree shape.</caption>
<tr>
<th>Parameter</th><th>Description </th></tr>
<tr>
<td>Scale</td><td>Scaling factor to specify overall tree size. Scale is generally the height of the tree. </td></tr>
<tr>
<td>0Length</td><td>Length of the tree trunk as a fraction of scale. Usually, 0Length is set to 1 (i.e., 100%). </td></tr>
<tr>
<td>BaseSize</td><td>Percentage of the tree height before vegetation/branches start (0&lt;BaseSize&lt;1). For a tree with no trunk, BaseSize=0. For a tree where vegetation is only present in the upper half of the tree, BaseSize=0.5.  </td></tr>
<tr>
<td>Ratio</td><td>Specifies the trunk radius at the base as a fraction of the length of the trunk. So Ratio=0.01 would have a trunk with radius at base of 1% of the trunk length. </td></tr>
<tr>
<td>0Taper</td><td>Reduction factor for trunk radius moving away from base (0&lt;=0Taper&lt;=1). Setting 0Taper to 0 results in a cylindrical trunk, setting 0Taper to 1 results in a conical trunk, and setting 0Taper between 0 and 1 gives a combination of the two. </td></tr>
<tr>
<td>Flare</td><td>Expansion of the trunk radius at the base by a factor of 1+Flare. </td></tr>
<tr>
<td>Shape</td><td>Flag corresponding to desired tree crown shape. See table below for available tree crown shapes. </td></tr>
<tr>
<td>BaseSplits</td><td>Number of trunk splits. For example, BaseSplits=1 gives on split and two distinct "scaffolds" or secondary trunks. BaseSplits=2 gives three distinct secondary trunk branches. </td></tr>
<tr>
<td>BaseSplitSize</td><td>If BaseSplits&gt;0, BaseSplitSize is the distance from the base of the tree to the split as a fraction of the height of the tree (0&lt;=BaseSplitSize&lt;=1). </td></tr>
<tr>
<td>0SplitAngle</td><td>Angle from vertical (degrees) of the split branch with respect to vertical. </td></tr>
</table>
<p>Creating new tree geometries typically starts by considering the overall size and shape of the tree. The above image shows a schematic sketch of the relevant parameters used to define these features.</p>
<p>The height of the tree in meters is given by the &lsquo;Scale/ScaleV&rsquo;. The height of the trunk portion with no branches is given by &lsquo;BaseSize&rsquo;, which is a fraction of the whole tree height. For example, if Scale=10 and BaseSize=0.4, the first 4 meters of the tree trunk would have no branches.</p>
<p>The trunk radius at the base is given as a fraction (Ratio) of the total height of the tree. For example, Ratio = 0.05 gives a trunk radius that is 5% of the total height of the tree. The trunk radius can taper along its lenght according to the parameter &lsquo;0Taper&rsquo;, with 0&lt;=0Taper&lt;=1. 0Taper=0 gives no tapering, and 0Taper=1 tapers the trunk to a point (i.e., radius=0).</p>
<p>The shape of the tree is given by the ID parameter 'Shape'. There are 8 supported tree shapes, which are given in the table below. One important caveat is when <b>BaseSplits</b> is greater than 0, in which case the shape applies to each individual split branch and not necessarily to the tree as a whole. So BaseSplits=0 and Shape=1 (spherical) would result in one split and two spherical crown sub-shapes.</p>
<table class="doxtable">
<caption>Available tree crown shapes</caption>
<tr>
<th>Shape</th><th>Description</th><th>Sketch </th></tr>
<tr>
<td>0</td><td>Conical</td><td><div class="image">
<img src="ShapeConical.png" alt=""/>
</div>
 </td></tr>
<tr>
<td>1</td><td>Spherical/Ellipsoidal</td><td><div class="image">
<img src="ShapeSpherical.png" alt=""/>
</div>
 </td></tr>
<tr>
<td>2</td><td>Hemispherical</td><td><div class="image">
<img src="ShapeHemispherical.png" alt=""/>
</div>
 </td></tr>
<tr>
<td>3</td><td>Cylindrical</td><td><div class="image">
<img src="ShapeCylindrical.png" alt=""/>
</div>
 </td></tr>
<tr>
<td>4</td><td>Tapered Cylindrical</td><td><div class="image">
<img src="ShapeTaperedCylindrical.png" alt=""/>
</div>
 </td></tr>
<tr>
<td>5</td><td>Flame</td><td><div class="image">
<img src="ShapeFlame.png" alt=""/>
</div>
 </td></tr>
<tr>
<td>6</td><td>Inverse Conical</td><td><div class="image">
<img src="ShapeInverseConical.png" alt=""/>
</div>
 </td></tr>
<tr>
<td>7</td><td>Tend Flame</td><td><div class="image">
<img src="ShapeTendFlame.png" alt=""/>
</div>
 </td></tr>
</table>
<h2><a class="anchor" id="WPTreeR1"></a>
Recursive Branches</h2>
<div class="image">
<img src="Sketch_1Level.jpeg" alt=""/>
</div>
<h2><a class="anchor" id="WPTreeLeaves"></a>
Leaves</h2>
<div class="image">
<img src="Sketch_Leaves.jpeg" alt=""/>
</div>
<h3><a class="anchor" id="WPTreeMask"></a>
Leaf mask</h3>
<p>The tree model uses a PNG texture mask to visualize leaves. This is a PNG image of the leaf with a transparent background. An example leaf mask is given in the image below. New leaf masks can be created using Gimp fairly easily. Simply find an image of the leaf, open in Gimp, add an alpha channel to the image, use the &lsquo;Fuzzy Select Tool&rsquo; to select the background, then go to Edit-&gt;Clear, and export in .png format. There are many tutorials online describing how to do this in more detail. Note that the leaf should be oriented as shown in the image below for consistency: petiole pointing to the left. Also note that the petiole is typically cropped out of the image.</p>
<h2><a class="anchor" id="WPTgL"></a>
User-Defined Leaf Angle Distribution Functions</h2>
<p>By default, the Weber-Penn tree model will create a semi-random leaf angle distribution by rotating leaves around its parent branch according to the parameters set for that particular tree. However, this is typically not realistic for how leaves arrange themselves in nature, and it is often desirable to specify a leaf angle distribution based on actual data. A custom leaf angle (inclination) distribution function can be specified for a given tree type in the tree library XML file using the tag '&lt;LeafAngleDist&gt; ... &lt;/LeafAngleDist&gt;'. The elements within the tag should be probability densities of leaf inclination for discrete angle classes ranging from \(\theta_L=0\) to \(\theta_L=\pi\) rad.</p>
<p>Here is an example: Imagine that we wanted to have N=18 discrete leaf angle bins in our leaf angle PDF \(g_L\). The width of one discrete bin would be \(\Delta \theta_L=\pi/18\approx 0.1795\) rad. Each of the 18 bins of our PDF \(g_L\) should give the probability density that we have a leaf inclination angle that falls within that bin. By definition, the following should hold for our PDF:</p>
<center> \(\sum\limits_{i=1}^N\,g_{L,i}\Delta \theta_L=1\)</center><p>If this condition is not met by the PDF input by the user, the program will ignore it and revert to the default behavior.</p>
<p>As a simple example, imagine we had only one leaf with an inclination of \(\theta_L=0.1\) rad. This leaf would fall in the first discrete bin of \(g_L\), which would have a value of \(1/\Delta \theta_L\) and all other bins would be zero.</p>
<p>For a typical almond tree, the PDF for N=18 is tabulated below. Note that we have the capability to have leaves pointing upward from their base ( \(\theta_L&lt;\pi/2\)) or leaves pointiing downward from their base ( \(\theta_L&gt;\pi/2\)). For simplicity, the distribution below considers only upward-facing normals.</p>
<center> <table class="doxtable">
<caption>Typical leaf angle distribution for almond</caption>
<tr>
<th>\(\theta_L\) bin (degrees)</th><th>\(g_L(\theta_L)\) </th></tr>
<tr>
<td>0-10</td><td>0.229 </td></tr>
<tr>
<td>10-20</td><td>0.665 </td></tr>
<tr>
<td>20-30</td><td>0.917 </td></tr>
<tr>
<td>30-40</td><td>0.945 </td></tr>
<tr>
<td>40-50</td><td>0.865 </td></tr>
<tr>
<td>50-60</td><td>0.745 </td></tr>
<tr>
<td>60-70</td><td>0.619 </td></tr>
<tr>
<td>70-80</td><td>0.424 </td></tr>
<tr>
<td>80-90</td><td>0.315 </td></tr>
<tr>
<td>90-100</td><td>0 </td></tr>
<tr>
<td>100-110</td><td>0 </td></tr>
<tr>
<td>110-120</td><td>0 </td></tr>
<tr>
<td>120-130</td><td>0 </td></tr>
<tr>
<td>130-140</td><td>0 </td></tr>
<tr>
<td>140-150</td><td>0 </td></tr>
<tr>
<td>150-160</td><td>0 </td></tr>
<tr>
<td>160-170</td><td>0 </td></tr>
<tr>
<td>180-180</td><td>0 </td></tr>
</table>
</center><p>This data would be input into the tree library XML file as follows:</p>
<div class="fragment"><div class="line">&lt;?xml version=1.0?&gt;</div>
<div class="line">&lt;helios&gt;</div>
<div class="line"> </div>
<div class="line">  &lt;<a class="code hl_class" href="class_weber_penn_tree.html">WeberPennTree</a> label=<span class="stringliteral">&quot;Almond&quot;</span>&gt;</div>
<div class="line">    &lt;!--</div>
<div class="line">    Many other parameters here</div>
<div class="line">    --&gt;</div>
<div class="line">    &lt;LeafAngleDist&gt;0.2290 0.6650 0.9170 0.9450 0.8650 0.7450 0.6190 0.4240 0.3100 0 0 0 0 0 0 0 0 0&lt;/LeafAngleDist&gt;</div>
<div class="line">  &lt;/<a class="code hl_class" href="class_weber_penn_tree.html">WeberPennTree</a>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;/helios&gt;</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
