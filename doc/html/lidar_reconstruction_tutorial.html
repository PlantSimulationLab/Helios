<!-- HTML header for doxygen 1.12.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Helios: Tutorial 15: Plant reconstruction using alpha mask methods</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph_link.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript">
  DoxygenAwesomeDarkModeToggle.init()
  DoxygenAwesomeParagraphLink.init()
  DoxygenAwesomeTabs.init()
  DoxygenAwesomeInteractiveToc.init()
</script>
<script>
    try {
        // Remove the stored “last visited page” so the tree always starts fresh
        Cookie.eraseSetting('navpath');
        localStorage.removeItem('navpath');
        // Older Doxygen versions might use this key:
        localStorage.removeItem('nav-sync-path');
    } catch(e) {
        /* storage unavailable? ignore */
    }
</script>
<script type="text/javascript" src="navsync-default.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-93BB4673PE"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-93BB4673PE');
</script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3F0Y5Z6543"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-3F0Y5Z6543');
</script>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="5">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="Helios_logo_small.png"></td>
  <td id="projectalign">
   <div id="projectname">
       <span id="projectnumber">&#160;v1.3.42</span>
   </div>
  </td>
     <td id="searchbox-container">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('lidar_reconstruction_tutorial.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Tutorial 15: Plant reconstruction using alpha mask methods</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial demonstrates how to perform plant reconstruction from LiDAR point clouds using alpha mask methods, and visually compare the reconstruction with the original PlantArchitecture model.</p>
<h1><a class="anchor" id="lidar_recon_intro"></a>
1. Introduction</h1>
<p>Plant reconstruction from LiDAR point clouds allows us to create 3D plant models that can be used for further analysis. The alpha mask method uses prototype leaf shapes to replace triangulated surfaces, creating more realistic-looking reconstructions.</p>
<h1><a class="anchor" id="lidar_recon_setup"></a>
2. Setup and Dependencies</h1>
<p>This tutorial requires the Visualizer plug-in for visual comparison:</p>
<div class="fragment"><div class="line">set( PLUGINS &quot;plantarchitecture;lidar;visualizer&quot; )</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_context_8h.html">Context.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_plant_architecture_8h.html">PlantArchitecture.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_li_d_a_r_8h.html">LiDAR.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_visualizer_8h.html">Visualizer.h</a>&quot;</span></div>
<div class="line"><span class="keyword">using namespace </span>helios;</div>
</div><!-- fragment --><h1><a class="anchor" id="lidar_recon_plant"></a>
3. Create Original Plant Model</h1>
<p>Create a plant model that we'll reconstruct from synthetic LiDAR:</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classhelios_1_1_context.html" title="Stores the state associated with simulation.">Context</a> original_context;</div>
<div class="line"><a class="code hl_class" href="class_plant_architecture.html">PlantArchitecture</a> plantarch(&amp;original_context);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create a plant with distinct leaf characteristics</span></div>
<div class="line"><a class="code hl_typedef" href="global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14" title="Unsigned integer type.">uint</a> plant_ID = plantarch.buildPlantArchitecture(<span class="stringliteral">&quot;recon_test_plant&quot;</span>);</div>
<div class="line"> </div>
<div class="line">PlantSpecies species;</div>
<div class="line">species.max_height = 2.0;</div>
<div class="line">species.a_k = 0.4;</div>
<div class="line">species.leaf_length.uniformDistribution(0.04, 0.07);</div>
<div class="line">species.leaf_width.uniformDistribution(0.02, 0.035);</div>
<div class="line">species.leaflet_count = 3;</div>
<div class="line">species.leaf_angle_distribution = <span class="stringliteral">&quot;erectophile&quot;</span>;</div>
<div class="line"> </div>
<div class="line">plantarch.setPlantSpecies(plant_ID, species);</div>
<div class="line">plantarch.growPlant(plant_ID, 35);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add some color variation for visualization</span></div>
<div class="line">std::vector&lt;uint&gt; UUIDs = original_context.<a class="code hl_function" href="classhelios_1_1_context.html#a98516632daccf958cca6b5b6582310bb" title="Get all primitive UUIDs currently in the Context.">getAllUUIDs</a>();</div>
<div class="line"><span class="keywordflow">for</span>(<a class="code hl_typedef" href="global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14" title="Unsigned integer type.">uint</a> UUID : UUIDs){</div>
<div class="line">    <span class="keywordflow">if</span>(original_context.<a class="code hl_function" href="classhelios_1_1_context.html#a67bfd66f0a445f6485f1099f9eadc949" title="Method to get the Primitive type.">getPrimitiveType</a>(UUID) == <a class="code hl_enumvalue" href="_context_8h.html#aa2778fcacd9c556a5ce0d9de2ffc1601a6fcd29f0c812849b3eb5bedec52cd744" title="&lt; Rectangular primitive">PRIMITIVE_TYPE_PATCH</a>){</div>
<div class="line">        original_context.<a class="code hl_function" href="classhelios_1_1_context.html#a5f95e8537f22f83b8376806cf40768d6" title="Method to set the diffuse color of a Primitive.">setPrimitiveColor</a>(UUID, RGB::green);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Original plant has &quot;</span> &lt;&lt; original_context.<a class="code hl_function" href="group__primitives.html#gaca0a0b6b65d8d3c7a64b66f98826e71a" title="Get the total number of Primitives in the Context.">getPrimitiveCount</a>() </div>
<div class="line">          &lt;&lt; <span class="stringliteral">&quot; primitives&quot;</span> &lt;&lt; std::endl;</div>
</div><!-- fragment --><h1><a class="anchor" id="lidar_recon_scan"></a>
4. Generate High-Quality Synthetic LiDAR Data</h1>
<div class="fragment"><div class="line"><a class="code hl_class" href="class_li_d_a_rcloud.html" title="Primary class for terrestrial LiDAR scan.">LiDARcloud</a> pointcloud;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// High-resolution scan for good reconstruction</span></div>
<div class="line">std::string scan_xml = <a class="code hl_variable" href="_energy_balance_model_8h.html#a05a585aa2556ffe7e436900a76c2113f" title="Gas constant, J mol⁻¹ K⁻¹">R</a>\<span class="stringliteral">&quot;(</span></div>
<div class="line"><span class="stringliteral">&lt;helios&gt;</span></div>
<div class="line"><span class="stringliteral">  &lt;scan&gt;</span></div>
<div class="line"><span class="stringliteral">    &lt;origin&gt;0 0 1.8&lt;/origin&gt;</span></div>
<div class="line"><span class="stringliteral">    &lt;size&gt;300 500&lt;/size&gt;</span></div>
<div class="line"><span class="stringliteral">    &lt;thetaMin&gt;15&lt;/thetaMin&gt;</span></div>
<div class="line"><span class="stringliteral">    &lt;thetaMax&gt;145&lt;/thetaMax&gt;</span></div>
<div class="line"><span class="stringliteral">    &lt;phiMin&gt;0&lt;/phiMin&gt;</span></div>
<div class="line"><span class="stringliteral">    &lt;phiMax&gt;360&lt;/phiMax&gt;</span></div>
<div class="line"><span class="stringliteral">    &lt;ASCII_format&gt;x y z r255 g255 b255&lt;/ASCII_format&gt;</span></div>
<div class="line"><span class="stringliteral">  &lt;/scan&gt;</span></div>
<div class="line"><span class="stringliteral">&lt;/helios&gt;</span></div>
<div class="line"><span class="stringliteral">)\&quot;;</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">std::ofstream scanfile(&quot;</span>recon_scan.xml<span class="stringliteral">&quot;);</span></div>
<div class="line"><span class="stringliteral">scanfile &lt;&lt; scan_xml;</span></div>
<div class="line"><span class="stringliteral">scanfile.close();</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">pointcloud.loadXML(&quot;</span>recon_scan.xml<span class="stringliteral">&quot;);</span></div>
<div class="line"><span class="stringliteral">pointcloud.syntheticScan(&amp;original_context);</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">std::cout &lt;&lt; &quot;</span>Generated <span class="stringliteral">&quot; &lt;&lt; pointcloud.getHitCount() &lt;&lt; &quot;</span> LiDAR points<span class="stringliteral">&quot; &lt;&lt; std::endl;</span></div>
</div><!-- fragment --><h1><a class="anchor" id="lidar_recon_grid"></a>
5. Setup Reconstruction Grid</h1>
<div class="fragment"><div class="line">std::string grid_xml = <a class="code hl_variable" href="_energy_balance_model_8h.html#a05a585aa2556ffe7e436900a76c2113f" title="Gas constant, J mol⁻¹ K⁻¹">R</a>\<span class="stringliteral">&quot;(</span></div>
<div class="line"><span class="stringliteral">&lt;helios&gt;</span></div>
<div class="line"><span class="stringliteral">  &lt;grid&gt;</span></div>
<div class="line"><span class="stringliteral">    &lt;center&gt;0 0 1.0&lt;/center&gt;</span></div>
<div class="line"><span class="stringliteral">    &lt;size&gt;2.5 2.5 2.0&lt;/size&gt;</span></div>
<div class="line"><span class="stringliteral">    &lt;Nx&gt;5&lt;/Nx&gt;</span></div>
<div class="line"><span class="stringliteral">    &lt;Ny&gt;5&lt;/Ny&gt;</span></div>
<div class="line"><span class="stringliteral">    &lt;Nz&gt;4&lt;/Nz&gt;</span></div>
<div class="line"><span class="stringliteral">  &lt;/grid&gt;</span></div>
<div class="line"><span class="stringliteral">&lt;/helios&gt;</span></div>
<div class="line"><span class="stringliteral">)\&quot;;</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">std::ofstream gridfile(&quot;</span>recon_grid.xml<span class="stringliteral">&quot;);</span></div>
<div class="line"><span class="stringliteral">gridfile &lt;&lt; grid_xml;</span></div>
<div class="line"><span class="stringliteral">gridfile.close();</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">pointcloud.loadXML(&quot;</span>recon_grid.xml<span class="stringliteral">&quot;);</span></div>
</div><!-- fragment --><h1><a class="anchor" id="lidar_recon_process"></a>
6. Point Cloud Processing</h1>
<div class="fragment"><div class="line"><span class="comment">// Fill gaps and triangulate</span></div>
<div class="line">pointcloud.<a class="code hl_function" href="class_li_d_a_rcloud.html#a53b80def6bff07231b8d2b10eb3e0330" title="For scans that are missing points (e.g., sky points), this function will attempt to fill in missing p...">gapfillMisses</a>();</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">float</span> Lmax = 0.03; <span class="comment">// Fine triangulation for good reconstruction</span></div>
<div class="line"><span class="keywordtype">float</span> max_aspect_ratio = 6.0;</div>
<div class="line">pointcloud.<a class="code hl_function" href="class_li_d_a_rcloud.html#ac495385c9dc7cc7773819ce77175242a" title="Perform triangulation on all hit points in point cloud.">triangulateHitPoints</a>(Lmax, max_aspect_ratio);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Calculate leaf area (required for reconstruction)</span></div>
<div class="line">pointcloud.<a class="code hl_function" href="class_li_d_a_rcloud.html#aff9aeedaa500516d1c227e5161fb599a" title="Calculate the leaf area for each grid volume.">calculateLeafAreaGPU</a>();</div>
<div class="line"> </div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Created &quot;</span> &lt;&lt; pointcloud.<a class="code hl_function" href="class_li_d_a_rcloud.html#abcdbf834959379a189a60efed41f3e52" title="Get the number of triangles formed by the triangulation.">getTriangleCount</a>() &lt;&lt; <span class="stringliteral">&quot; triangles&quot;</span> &lt;&lt; std::endl;</div>
</div><!-- fragment --><h1><a class="anchor" id="lidar_recon_alphamask"></a>
7. Alpha Mask Reconstruction</h1>
<div class="fragment"><div class="line"><span class="comment">// Perform alpha mask reconstruction</span></div>
<div class="line"><span class="keywordtype">float</span> min_leaf_area = 0.0005; <span class="comment">// Minimum area threshold for reconstruction</span></div>
<div class="line"><span class="keywordtype">float</span> max_leaf_area = 0.01;   <span class="comment">// Maximum area threshold</span></div>
<div class="line"><span class="keywordtype">float</span> leaf_aspect_ratio = 2.0; <span class="comment">// Length/width ratio of prototype leaf</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* mask_file = <span class="stringliteral">&quot;plugins/visualizer/textures/SoybeanLeaf.png&quot;</span>; <span class="comment">// Alpha mask texture</span></div>
<div class="line"> </div>
<div class="line">pointcloud.<a class="code hl_function" href="class_li_d_a_rcloud.html#aba102c6c5036ffb99b105fb2b4850935" title="Perform a leaf reconstruction based on texture-masked Patches within each gridcell....">leafReconstructionAlphaMask</a>(min_leaf_area, max_leaf_area, </div>
<div class="line">                                       leaf_aspect_ratio, mask_file);</div>
<div class="line"> </div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Alpha mask reconstruction completed&quot;</span> &lt;&lt; std::endl;</div>
</div><!-- fragment --><h1><a class="anchor" id="lidar_recon_context"></a>
8. Add Reconstruction to Context</h1>
<div class="fragment"><div class="line"><span class="comment">// Create new context for reconstructed plant</span></div>
<div class="line"><a class="code hl_class" href="classhelios_1_1_context.html" title="Stores the state associated with simulation.">Context</a> reconstructed_context;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add reconstructed elements to context</span></div>
<div class="line">pointcloud.<a class="code hl_function" href="class_li_d_a_rcloud.html#aeca8578d8b5ecbc92fa669c612196f8c" title="Add reconstructed leaves (texture-masked patches) to the Context.">addLeafReconstructionToContext</a>(&amp;reconstructed_context);</div>
<div class="line"> </div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Reconstructed plant has &quot;</span> &lt;&lt; reconstructed_context.<a class="code hl_function" href="group__primitives.html#gaca0a0b6b65d8d3c7a64b66f98826e71a" title="Get the total number of Primitives in the Context.">getPrimitiveCount</a>() </div>
<div class="line">          &lt;&lt; \<span class="stringliteral">&quot; primitives&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Color the reconstructed leaves differently for comparison</span></div>
<div class="line">std::vector&lt;uint&gt; recon_UUIDs = reconstructed_context.<a class="code hl_function" href="classhelios_1_1_context.html#a98516632daccf958cca6b5b6582310bb" title="Get all primitive UUIDs currently in the Context.">getAllUUIDs</a>();</div>
<div class="line"><span class="keywordflow">for</span>(<a class="code hl_typedef" href="global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14" title="Unsigned integer type.">uint</a> UUID : recon_UUIDs){</div>
<div class="line">    reconstructed_context.<a class="code hl_function" href="classhelios_1_1_context.html#a5f95e8537f22f83b8376806cf40768d6" title="Method to set the diffuse color of a Primitive.">setPrimitiveColor</a>(UUID, RGB::red);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="lidar_recon_visualize"></a>
9. Visual Comparison</h1>
<div class="fragment"><div class="line"><span class="comment">// Create visualizer for comparison</span></div>
<div class="line"><a class="code hl_class" href="class_visualizer.html" title="Class for visualization of simulation results.">Visualizer</a> vis(1200);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add both original and reconstructed plants to visualizer</span></div>
<div class="line"><span class="comment">// Original plant (green)</span></div>
<div class="line">std::vector&lt;uint&gt; orig_UUIDs = original_context.<a class="code hl_function" href="classhelios_1_1_context.html#a98516632daccf958cca6b5b6582310bb" title="Get all primitive UUIDs currently in the Context.">getAllUUIDs</a>();</div>
<div class="line"><span class="keywordflow">for</span>(<a class="code hl_typedef" href="global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14" title="Unsigned integer type.">uint</a> UUID : orig_UUIDs){</div>
<div class="line">    <span class="keywordflow">if</span>(original_context.<a class="code hl_function" href="classhelios_1_1_context.html#a67bfd66f0a445f6485f1099f9eadc949" title="Method to get the Primitive type.">getPrimitiveType</a>(UUID) == <a class="code hl_enumvalue" href="_context_8h.html#aa2778fcacd9c556a5ce0d9de2ffc1601a6fcd29f0c812849b3eb5bedec52cd744" title="&lt; Rectangular primitive">PRIMITIVE_TYPE_PATCH</a>){</div>
<div class="line">        std::vector&lt;vec3&gt; vertices = original_context.<a class="code hl_function" href="classhelios_1_1_context.html#ae8542fd1452150d3302675a0a3d991ed" title="Method to return the (x,y,z) coordinates of the vertices of a Primitive.">getPrimitiveVertices</a>(UUID);</div>
<div class="line">        <a class="code hl_struct" href="structhelios_1_1_r_g_bcolor.html" title="R-G-B color vector.">RGBcolor</a> color = original_context.<a class="code hl_function" href="classhelios_1_1_context.html#a1223205f1080b0b7024b8f97950779b8" title="Method to return the diffuse color of a Primitive.">getPrimitiveColor</a>(UUID);</div>
<div class="line">        vis.addTriangle(vertices[0], vertices[1], vertices[2], color, 0.7);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Reconstructed plant (red, slightly offset for comparison)</span></div>
<div class="line"><a class="code hl_struct" href="structhelios_1_1vec3.html" title="Vector of three elements of type &#39;float&#39;.">vec3</a> offset(0.5, 0, 0); <span class="comment">// Offset for side-by-side comparison</span></div>
<div class="line"><span class="keywordflow">for</span>(<a class="code hl_typedef" href="global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14" title="Unsigned integer type.">uint</a> UUID : recon_UUIDs){</div>
<div class="line">    <span class="keywordflow">if</span>(reconstructed_context.<a class="code hl_function" href="classhelios_1_1_context.html#a67bfd66f0a445f6485f1099f9eadc949" title="Method to get the Primitive type.">getPrimitiveType</a>(UUID) == <a class="code hl_enumvalue" href="_context_8h.html#aa2778fcacd9c556a5ce0d9de2ffc1601a6fcd29f0c812849b3eb5bedec52cd744" title="&lt; Rectangular primitive">PRIMITIVE_TYPE_PATCH</a>){</div>
<div class="line">        std::vector&lt;vec3&gt; vertices = reconstructed_context.<a class="code hl_function" href="classhelios_1_1_context.html#ae8542fd1452150d3302675a0a3d991ed" title="Method to return the (x,y,z) coordinates of the vertices of a Primitive.">getPrimitiveVertices</a>(UUID);</div>
<div class="line">        <a class="code hl_struct" href="structhelios_1_1_r_g_bcolor.html" title="R-G-B color vector.">RGBcolor</a> color = reconstructed_context.<a class="code hl_function" href="classhelios_1_1_context.html#a1223205f1080b0b7024b8f97950779b8" title="Method to return the diffuse color of a Primitive.">getPrimitiveColor</a>(UUID);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Apply offset</span></div>
<div class="line">        <span class="keywordflow">for</span>(<a class="code hl_struct" href="structhelios_1_1vec3.html" title="Vector of three elements of type &#39;float&#39;.">vec3</a>&amp; v : vertices){</div>
<div class="line">            v = v + offset;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        vis.addTriangle(vertices[0], vertices[1], vertices[2], color, 0.7);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add LiDAR points for reference</span></div>
<div class="line">pointcloud.<a class="code hl_function" href="class_li_d_a_rcloud.html#a2102dd4711658414cca10fd40a66af18" title="Add all hit points to the visualizer plug-in, and color them by their r-g-b color.">addHitsToVisualizer</a>(&amp;vis, 2); <span class="comment">// Size 2 points</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add coordinate axes</span></div>
<div class="line">vis.addCoordinateAxes();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Launch interactive visualization</span></div>
<div class="line">vis.plotInteractive();</div>
</div><!-- fragment --><h1><a class="anchor" id="lidar_recon_analysis"></a>
10. Quantitative Comparison</h1>
<div class="fragment"><div class="line"><span class="comment">// Compare total leaf areas</span></div>
<div class="line"><span class="keywordtype">float</span> original_total_area = 0;</div>
<div class="line"><span class="keywordflow">for</span>(<a class="code hl_typedef" href="global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14" title="Unsigned integer type.">uint</a> UUID : orig_UUIDs){</div>
<div class="line">    <span class="keywordflow">if</span>(original_context.<a class="code hl_function" href="classhelios_1_1_context.html#a67bfd66f0a445f6485f1099f9eadc949" title="Method to get the Primitive type.">getPrimitiveType</a>(UUID) == <a class="code hl_enumvalue" href="_context_8h.html#aa2778fcacd9c556a5ce0d9de2ffc1601a6fcd29f0c812849b3eb5bedec52cd744" title="&lt; Rectangular primitive">PRIMITIVE_TYPE_PATCH</a>){</div>
<div class="line">        original_total_area += original_context.<a class="code hl_function" href="classhelios_1_1_context.html#a1dafe58b3251d2ef9d09112258b2e85d" title="Method to return the surface area of a Primitive.">getPrimitiveArea</a>(UUID);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">float</span> reconstructed_total_area = 0;</div>
<div class="line"><span class="keywordflow">for</span>(<a class="code hl_typedef" href="global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14" title="Unsigned integer type.">uint</a> UUID : recon_UUIDs){</div>
<div class="line">    <span class="keywordflow">if</span>(reconstructed_context.<a class="code hl_function" href="classhelios_1_1_context.html#a67bfd66f0a445f6485f1099f9eadc949" title="Method to get the Primitive type.">getPrimitiveType</a>(UUID) == <a class="code hl_enumvalue" href="_context_8h.html#aa2778fcacd9c556a5ce0d9de2ffc1601a6fcd29f0c812849b3eb5bedec52cd744" title="&lt; Rectangular primitive">PRIMITIVE_TYPE_PATCH</a>){</div>
<div class="line">        reconstructed_total_area += reconstructed_context.<a class="code hl_function" href="classhelios_1_1_context.html#a1dafe58b3251d2ef9d09112258b2e85d" title="Method to return the surface area of a Primitive.">getPrimitiveArea</a>(UUID);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;\\n=== Reconstruction Comparison ===&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Original total leaf area: &quot;</span> &lt;&lt; original_total_area &lt;&lt; \<span class="stringliteral">&quot; m²&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Reconstructed total area: &quot;</span> &lt;&lt; reconstructed_total_area &lt;&lt; \<span class="stringliteral">&quot; m²&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Reconstruction efficiency: \&quot; </span></div>
<div class="line"><span class="stringliteral">          &lt;&lt; (reconstructed_total_area/original_total_area*100) &lt;&lt; \&quot; %&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Compare leaf count</span></div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Original leaf count: &quot;</span> &lt;&lt; orig_UUIDs.size() &lt;&lt; std::endl;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Reconstructed leaf count: &quot;</span> &lt;&lt; recon_UUIDs.size() &lt;&lt; std::endl;</div>
</div><!-- fragment --><h1><a class="anchor" id="lidar_recon_export"></a>
11. Export Results</h1>
<div class="fragment"><div class="line"><span class="comment">// Export reconstructed model</span></div>
<div class="line">reconstructed_context.<a class="code hl_function" href="classhelios_1_1_context.html#aa3a926087e572ac8298c01862f752d44" title="Write geometry in the Context to a Wavefront file (.obj)">writeOBJ</a>(<span class="stringliteral">&quot;reconstructed_plant.obj&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Export point cloud</span></div>
<div class="line">pointcloud.<a class="code hl_function" href="class_li_d_a_rcloud.html#a2d0c11c6d8001171269232ff5d7f6322" title="Export to file all points in the point cloud to an ASCII text file following the column format specif...">exportPointCloud</a>(<span class="stringliteral">&quot;reconstruction_pointcloud.xyz&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Export original model for comparison</span></div>
<div class="line">original_context.<a class="code hl_function" href="classhelios_1_1_context.html#aa3a926087e572ac8298c01862f752d44" title="Write geometry in the Context to a Wavefront file (.obj)">writeOBJ</a>(<span class="stringliteral">&quot;original_plant.obj&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Export reconstruction statistics</span></div>
<div class="line">std::ofstream stats(<span class="stringliteral">&quot;reconstruction_stats.txt&quot;</span>);</div>
<div class="line">stats &lt;&lt; <span class="stringliteral">&quot;Metric\\tOriginal\\tReconstructed\\tRatio\\n&quot;</span>;</div>
<div class="line">stats &lt;&lt; <span class="stringliteral">&quot;Total_Area\\t&quot;</span> &lt;&lt; original_total_area &lt;&lt; <span class="stringliteral">&quot;\\t&quot;</span> </div>
<div class="line">      &lt;&lt; reconstructed_total_area &lt;&lt; <span class="stringliteral">&quot;\\t&quot;</span> </div>
<div class="line">      &lt;&lt; (reconstructed_total_area/original_total_area) &lt;&lt; <span class="stringliteral">&quot;\\n&quot;</span>;</div>
<div class="line">stats &lt;&lt; <span class="stringliteral">&quot;Leaf_Count\\t&quot;</span> &lt;&lt; orig_UUIDs.size() &lt;&lt; <span class="stringliteral">&quot;\\t&quot;</span> </div>
<div class="line">      &lt;&lt; recon_UUIDs.size() &lt;&lt; <span class="stringliteral">&quot;\\t&quot;</span> </div>
<div class="line">      &lt;&lt; (float(recon_UUIDs.size())/float(orig_UUIDs.size())) &lt;&lt; <span class="stringliteral">&quot;\\n&quot;</span>;</div>
<div class="line">stats &lt;&lt; <span class="stringliteral">&quot;LiDAR_Points\\t&quot;</span> &lt;&lt; pointcloud.<a class="code hl_function" href="class_li_d_a_rcloud.html#a691fd3bbd1262d80e10a674c82c6f568" title="Get the number of hit points in the point cloud.">getHitCount</a>() &lt;&lt; <span class="stringliteral">&quot;\\t&quot;</span> </div>
<div class="line">      &lt;&lt; pointcloud.<a class="code hl_function" href="class_li_d_a_rcloud.html#a691fd3bbd1262d80e10a674c82c6f568" title="Get the number of hit points in the point cloud.">getHitCount</a>() &lt;&lt; <span class="stringliteral">&quot;\\t1.0\\n&quot;</span>;</div>
<div class="line">stats &lt;&lt; <span class="stringliteral">&quot;Triangles\\t&quot;</span> &lt;&lt; pointcloud.<a class="code hl_function" href="class_li_d_a_rcloud.html#abcdbf834959379a189a60efed41f3e52" title="Get the number of triangles formed by the triangulation.">getTriangleCount</a>() &lt;&lt; <span class="stringliteral">&quot;\\t&quot;</span> </div>
<div class="line">      &lt;&lt; pointcloud.<a class="code hl_function" href="class_li_d_a_rcloud.html#abcdbf834959379a189a60efed41f3e52" title="Get the number of triangles formed by the triangulation.">getTriangleCount</a>() &lt;&lt; <span class="stringliteral">&quot;\\t1.0\\n&quot;</span>;</div>
<div class="line">stats.close();</div>
<div class="line"> </div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;\\nReconstruction complete! Check the exported files:\\n&quot;</span>;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;- reconstructed_plant.obj (3D model)\\n&quot;</span>;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;- original_plant.obj (reference model)\\n&quot;</span>;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;- reconstruction_stats.txt (comparison metrics)\\n&quot;</span>;</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
